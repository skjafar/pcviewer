cscope 15 $HOME/project/tools/pcviewer/model               0000063153
	@block.cpp

1 
	~"mod–/block.h
"

3 
	gBlock
::
	$Block
(
CommuniÿtÜ
* 
communiÿtÜ
, 
Regi¡”sM­
* 
»gi¡”s
, 
QSŒšg
 
Çme
, 
ušt32_t
 
add»ss
, ušt32_ˆ
off£t
, ušt32_ˆ
numb”OfRegi¡”s
, 
QObjeù
 *
·»Á
) :

4 
	`QObjeù
(
·»Á
), 
	`m_communiÿtÜ
(
communiÿtÜ
), 
	`m_»gi¡”s
(
»gi¡”s
), 
	`m_Çme
(
Çme
), 
	`m_add»ss
(
add»ss
), 
	`m_off£t
(
off£t
), 
	$m_numb”OfRegi¡”s
(
numb”OfRegi¡”s
)

5 {
	}
}

7 
	gBlock
::~
	$Block
(è{
	}
}

9 
boŞ
 
Block
::
	$isRAM
() const

11  
m_Çme
 == "RAM";

12 
	}
}

14 
boŞ
 
	gBlock
::
	$isP¬am‘”S‘
() const

16  
m_add»ss
 >= 15 && m_address <= 18;

17 
	}
}

19 
ušt32_t
 
	gBlock
::
	$off£t
() const

21  
m_off£t
;

22 
	}
}

24 
ušt32_t
 
	gBlock
::
	$add»ss
() const

26  
m_add»ss
;

27 
	}
}

29 
ušt32_t
 
	gBlock
::
	$numb”OfRegi¡”s
() const

31  
m_numb”OfRegi¡”s
;

32 
	}
}

34 
QSŒšg
 
	gBlock
::
	$Çme
() const

36  
m_Çme
;

37 
	}
}

39 
	gBlock
::
	$»ad
()

41 
BlockReque¡Machše
* 
machše
 = 
Ãw
 
	`BlockReque¡Machše
(
BlockReque¡Ty³_R—d
, 
this
, 
m_»gi¡”s
,his);

42 
	`cÚÃù
(
machše
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
BlockReque¡Machše
*)), 
this
, 
	`SLOT
(
	`ÚMachšeR—dDÚe
(BlockRequestMachine*)));

43 
	`cÚÃù
(
machše
, 
	`SIGNAL
(
	`ÚE¼Ü
(
BlockReque¡Machše
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`ÚMachšeE¼Ü
(BlockRequestMachine*,request_error_t)));

44 
m_communiÿtÜ
->
	`queueReque¡
(
machše
->
	`g‘Reque¡
());

45 
	}
}

47 
	gBlock
::
	$wr™e
(
QBy‹A¼ay
 
d©a
)

49 
BlockReque¡Machše
* 
machše
 = 
Ãw
 
	`BlockReque¡Machše
(
BlockReque¡Ty³_Wr™e
, 
this
, 
m_»gi¡”s
,his);

50 
machše
->
	`£tD©a
(
d©a
);

52 
	`cÚÃù
(
machše
, 
	`SIGNAL
(
	`ÚWr™eDÚe
(
BlockReque¡Machše
*)), 
this
, 
	`SLOT
(
	`ÚMachšeWr™eDÚe
(BlockRequestMachine*)));

53 
	`cÚÃù
(
machše
, 
	`SIGNAL
(
	`ÚE¼Ü
(
BlockReque¡Machše
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`ÚMachšeE¼Ü
(BlockRequestMachine*,request_error_t)));

54 
m_communiÿtÜ
->
	`queueReque¡
(
machše
->
	`g‘Reque¡
());

55 
	}
}

57 
	gBlock
::
	$ÚMachšeR—dDÚe
(
BlockReque¡Machše
* 
machše
)

59 
em™
 
	`ÚR—dDÚe
(
this
, 
machše
->
	`d©a
());

60 
machše
->
	`d–‘eL©”
();

61 
	}
}

63 
	gBlock
::
	$ÚMachšeE¼Ü
(
BlockReque¡Machše
* 
machše
, 
»que¡_”rÜ_t
 
”rÜCode
)

65 
em™
 
	`ÚE¼Ü
(
this
, 
”rÜCode
);

66 
machše
->
	`d–‘eL©”
();

67 
	}
}

69 
	gBlock
::
	$ÚMachšeWr™eDÚe
(
BlockReque¡Machše
* 
machše
)

71 
em™
 
	`ÚWr™eDÚe
(
this
);

72 
machše
->
	`d–‘eL©”
();

73 
	}
}

	@block.h

1 #iâdeà
BLOCK_H


2 
	#BLOCK_H


	)

4 
	~<QObjeù
>

5 
	~<QSŒšg
>

7 
	~"mod–/communiÿtÜ.h
"

8 
	~"mod–/»gi¡”s_m­.h
"

9 
	~"mod–/block_»que¡_machše.h
"

11 
şass
 
	gBlockReque¡Machše
;

13 şas 
	cBlock
 : 
public
 
QObjeù


15 
Q_OBJECT


16 
public
:

17 
ex¶ic™
 
Block
(
CommuniÿtÜ
* 
communiÿtÜ
, 
Regi¡”sM­
* 
»gi¡”s
, 
QSŒšg
 
Çme
, 
ušt32_t
 
add»ss
, ušt32_ˆ
off£t
, ušt32_ˆ
numb”OfRegi¡”s
, 
QObjeù
 *
·»Á
 = 0);

18 ~
Block
();

20 
boŞ
 
	$isRAM
() const;

21 
boŞ
 
	$isP¬am‘”S‘
() const;

22 
ušt32_t
 
	$add»ss
() const;

23 
ušt32_t
 
	$off£t
() const;

24 
ušt32_t
 
	$numb”OfRegi¡”s
() const;

25 
QSŒšg
 
	$Çme
() const;

27 
sigÇls
:

28 
	`ÚR—dDÚe
(
Block
*, 
QBy‹A¼ay
);

29 
	`ÚWr™eDÚe
(
Block
*);

30 
	`ÚE¼Ü
(
Block
*, 
»que¡_”rÜ_t
 
”rÜCode
);

32 
public
 
¦Ùs
:

33 
	`»ad
();

34 
	`wr™e
(
QBy‹A¼ay
);

36 
´iv©e
 
¦Ùs
:

37 
	`ÚMachšeR—dDÚe
(
BlockReque¡Machše
 *);

38 
	`ÚMachšeWr™eDÚe
(
BlockReque¡Machše
 *);

39 
	`ÚMachšeE¼Ü
(
BlockReque¡Machše
 *, 
»que¡_”rÜ_t
 
”rÜCode
);

41 
´iv©e
:

42 
CommuniÿtÜ
* 
m_communiÿtÜ
;

43 
Regi¡”sM­
* 
m_»gi¡”s
;

45 
QSŒšg
 
m_Çme
;

46 
ušt32_t
 
m_add»ss
;

47 
ušt32_t
 
m_off£t
;

48 
ušt32_t
 
m_numb”OfRegi¡”s
;

	@block_request.cpp

1 
	~"mod–/block_»que¡.h
"

3 
	gBlockReque¡
::
	$BlockReque¡
(
BlockReque¡Ty³
 
»que¡Ty³
, 
ušt32_t
 
add»ss
, ušt32_ˆ
off£t
, ušt32_ˆ
numb”OfRegi¡”s
, 
QObjeù
 *
·»Á
) :

4 
	`QObjeù
(
·»Á
), 
	`m_»que¡Ty³
(
»que¡Ty³
), 
	`m_add»ss
(
add»ss
), 
	`m_off£t
(
off£t
), 
	$m_numb”OfRegi¡”s
(
numb”OfRegi¡”s
)

6 
	}
}

8 
	gBlockReque¡
::
	$£tD©a
(
QBy‹A¼ay
 
d©a
)

11 
m_d©a
 = 
d©a
;

12 
	}
}

14 
	gBlockReque¡
::
	$­³ndBy‹s
(cÚ¡ * 
by‹s
, 
size_t
 
Ën
)

16 
this
->
m_d©a
.
	`­³nd
(
by‹s
, 
Ën
);

17 
	}
}

19 * 
	gBlockReque¡
::
	$g‘Mes§ge
() const

21 * 
msg
 = (*è
	`m®loc
(
	`mes§geL’gth
());

22 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
)

24 
msg
[0] = 
BlockReque¡Ty³_R—d
;

25 
	`memıy
(
msg
 + 1, &
m_off£t
, 4);

26 
	`memıy
(
msg
 + 5, &
m_numb”OfRegi¡”s
, 4);

27  
msg
;

29 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
)

31 
ušt32_t
 
Ëngth
 = 
m_d©a
.
	`Ëngth
() / ();

32 
msg
[0] = 
BlockReque¡Ty³_Wr™e
;

33 
	`memıy
(
msg
 + 1, &
m_off£t
, 4);

34 
	`memıy
(
msg
 + 5, &
Ëngth
, 4);

35 
	`memıy
(
msg
 + 9, 
m_d©a
.
	`d©a
(), m_d©a.
	`Ëngth
());

36  
msg
;

40 
	`Q_ASSERT
(0);

42 
	}
}

44 
	gBlockReque¡
::
	$ä“Mes§ge
(* 
mes§ge
) const

46 
	`ä“
(
mes§ge
);

47 
	}
}

49 
ušt32_t
 
	gBlockReque¡
::
	$mes§geL’gth
() const

51 cÚ¡ 
ušt32_t
 
CMD_LENGTH
 = 1;

52 cÚ¡ 
ušt32_t
 
ADDRESS_LENGTH
 = 4;

53 cÚ¡ 
ušt32_t
 
LENGTH_LENGTH
 = 4;

54 cÚ¡ 
ušt32_t
 
BASE_LENGTH
 = 
CMD_LENGTH
 + 
ADDRESS_LENGTH
 + 
LENGTH_LENGTH
;

56 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
)

57  
BASE_LENGTH
;

58 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
)

59  
BASE_LENGTH
 + 
this
->
m_d©a
.
	`Ëngth
();

61 
	`Q_ASSERT
(0);

62 
	}
}

64 
	gBlockReque¡
::
	$ÚTimeout
()

66 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

67 
	}
}

69 
ušt32_t
 
	gBlockReque¡
::
	$»maššgBy‹s
() const

71 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
)

72  
m_numb”OfRegi¡”s
 * (
ušt32_t
è- 
m_d©a
.
	`Ëngth
();

73 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
)

76 
	`Q_ASSERT
(0);

77 
	}
}

79 
SomeReque¡
 
	gBlockReque¡
::
	$hªdËRe¥Ú£
()

81 
	`Q_ASSERT
(
	`»maššgBy‹s
() == 0);

84 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
)

85 
em™
 
	`ÚR—dDÚe
(
this
);

86 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
)

87 
em™
 
	`ÚWr™eDÚe
(
this
);

89 
SomeReque¡
 
»que¡
;

90 ià(
g‘NextReque¡
 !ğ
NULL
)

91 
»que¡
 = 
	`g‘NextReque¡
(
m_u£rArg
);

93 
»que¡
 = 
	`SomeReque¡
();

95 
em™
 
	`ÚHªdlšgDÚe
(
this
);

96  
»que¡
;

97 
	}
}

	@block_request.h

1 #iâdeà
BLOCK_REQUEST_H


2 
	#BLOCK_REQUEST_H


	)

4 
	~<QObjeù
>

5 
	~"mod–/»que¡.h
"

7 
	gSomeReque¡
;

9 
	gBlockReque¡Ty³
 : 
ušt8_t


11 
BlockReque¡Ty³_R—d
 = 0x01,

12 
	gBlockReque¡Ty³_Wr™e
 = 0x02

15 şas 
	cBlockReque¡
 : 
public
 
QObjeù


17 
Q_OBJECT


19 
public
:

20 
ex¶ic™
 
BlockReque¡
(
BlockReque¡Ty³
 
»que¡Ty³
, 
ušt32_t
 
add»ss
, ušt32_ˆ
off£t
, ušt32_ˆ
numb”OfRegi¡”s
, 
QObjeù
 *
·»Á
 = 0);

22 
QBy‹A¼ay
 
	$d©a
(ècÚ¡ {  
this
->
m_d©a
; }

23 
BlockReque¡Ty³
 
	$»que¡Ty³
(ècÚ¡ {  
this
->
m_»que¡Ty³
; 
	}
}

24 
ušt32_t
 
	$»maššgBy‹s
() const;

25 * 
	$g‘Mes§ge
() const;

26 
	$ä“Mes§ge
(* 
mes§ge
) const;

27 
ušt32_t
 
	$mes§geL’gth
() const;

29 
	`­³ndBy‹s
(cÚ¡ * 
by‹s
, 
size_t
 
Ën
);

31 
SomeReque¡
 
	`hªdËRe¥Ú£
();

32 
	$SomeReque¡
 (*
g‘NextReque¡
)(* 
u£rArg
);

33 * 
m_u£rArg
;

35 
sigÇls
:

36 
	`ÚR•ly
(
BlockReque¡
* 
»que¡
);

37 
	`ÚR—dDÚe
(
BlockReque¡
* 
»que¡
);

38 
	`ÚWr™eDÚe
(
BlockReque¡
* 
»que¡
);

39 
	`ÚE¼Ü
(
BlockReque¡
* 
»que¡
, 
»que¡_”rÜ_t
 
”rÜCode
);

40 
	`ÚHªdlšgDÚe
(
BlockReque¡
* 
»que¡
);

42 
public
 
¦Ùs
:

43 
	`£tD©a
(
QBy‹A¼ay
 
d©a
);

44 
	`ÚTimeout
();

46 
´iv©e
:

47 
BlockReque¡Ty³
 
m_»que¡Ty³
;

48 
ušt32_t
 
m_add»ss
;

49 
ušt32_t
 
m_off£t
;

50 
ušt32_t
 
m_numb”OfRegi¡”s
;

51 
ušt32_t
 
m_»maššgBy‹s
;

53 
QBy‹A¼ay
 
m_d©a
;

54 
	}
};

	@block_request_machine.cpp

1 
	~"mod–/block_»que¡_machše.h
"

2 
	~"d©a/d©a.h
"

4 
	gBlockReque¡Machše
::
	$BlockReque¡Machše
(
BlockReque¡Ty³
 
ty³
, 
Block
 *
block
, 
Regi¡”sM­
 *
»gi¡”s
, 
QObjeù
 *
·»Á
) :

5 
	`QObjeù
(
·»Á
), 
	`m_block
(
block
), 
	`m_»que¡Ty³
(
ty³
), 
	$m_d©a
()

7 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
)

8 
m_»adS‹
 = 
BlockReque¡R—dS‹_In™Ÿl
;

9 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
)

10 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_In™Ÿl
;

12 
this
->
m_d©aT¿nsãrIn™Regi¡”
 = 
»gi¡”s
->
	`g‘
(
DATA_TRANSFER_INIT_REGISTER_NAME
);

13 
this
->
m_d©aBlockDe¡š©iÚRegi¡”
 = 
»gi¡”s
->
	`g‘
(
DATA_BLOCK_DESTINATION_REGISTER_NAME
);

14 
this
->
m_deviûO³¿tšgS‹Regi¡”
 = 
»gi¡”s
->
	`g‘
(
DEVICE_OPERATING_STATE_REGISTER_NAME
);

15 
this
->
m_sy¡emO³¿tšgS‹Regi¡”
 = 
»gi¡”s
->
	`g‘
(
SYSTEM_OPERATING_STATE_REGISTER_NAME
);

16 
	}
}

18 
SomeReque¡
 
	$ÃxtT¿ns™iÚReque¡
(* 
u£rArg
)

20 
BlockReque¡Machše
* 
blockReque¡
 = (BlockReque¡Machše*è
u£rArg
;

21  
blockReque¡
->
	`g‘Reque¡
();

22 
	}
}

24 
	gBlockReque¡Machše
::
	$»gi¡”Reque¡DÚe
(
Regi¡”Reque¡
 *
»que¡
)

26 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
)

27 
this
->
	`»adT¿ns™iÚ
(
	`SomeReque¡
(
»que¡
));

28 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
)

29 
this
->
	`wr™eT¿ns™iÚ
(
	`SomeReque¡
(
»que¡
));

31 
	`Q_ASSERT
(0);

33 
»que¡
->
m_u£rArg
 = 
this
;

34 
»que¡
->
g‘NextReque¡
 = 
ÃxtT¿ns™iÚReque¡
;

35 
	}
}

37 
	gBlockReque¡Machše
::
	$blockReque¡DÚe
(
BlockReque¡
 *
»que¡
)

39 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
)

40 
this
->
	`»adT¿ns™iÚ
(
	`SomeReque¡
(
»que¡
));

41 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
)

42 
this
->
	`wr™eT¿ns™iÚ
(
	`SomeReque¡
(
»que¡
));

44 
	`Q_ASSERT
(0);

46 
»que¡
->
m_u£rArg
 = 
this
;

47 
»que¡
->
g‘NextReque¡
 = 
ÃxtT¿ns™iÚReque¡
;

48 
	}
}

50 
	gBlockReque¡Machše
::
	$»gi¡”Reque¡D–‘e
(
Regi¡”Reque¡
 *
»que¡
)

52 
»que¡
->
	`d–‘eL©”
();

53 
	}
}

55 
	gBlockReque¡Machše
::
	$blockReque¡D–‘e
(
BlockReque¡
 *
»que¡
)

57 
»que¡
->
	`d–‘eL©”
();

58 
	}
}

60 
	gBlockReque¡Machše
::
	$»gi¡”Reque¡E¼Ü
(
Regi¡”Reque¡
 *, 
»que¡_”rÜ_t
 
”rCode
)

62 
em™
 
	`ÚE¼Ü
(
this
, 
”rCode
);

63 
	}
}

65 
	gBlockReque¡Machše
::
	$blockReque¡E¼Ü
(
BlockReque¡
 *, 
»que¡_”rÜ_t
 
”rCode
)

67 
em™
 
	`ÚE¼Ü
(
this
, 
”rCode
);

68 
	}
}

70 
SomeReque¡
 
	gBlockReque¡Machše
::
	$g‘Reque¡
()

72 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
)

73  
this
->
	`»adAùiÚ
();

74 ià(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
)

75  
this
->
	`wr™eAùiÚ
();

77 
	`Q_ASSERT
(0);

78 
	}
}

80 
	gBlockReque¡Machše
::
	$»adT¿ns™iÚ
(
SomeReque¡
 
»que¡
)

82 
	`Q_ASSERT
(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
);

84 
m_»adS‹
)

87 
BlockReque¡R—dS‹_In™Ÿl
:

89 
m_»adS‹
 = 
BlockReque¡R—dS‹_V”ifySeùÜS‘
;

90 
m_tim”
.
	`¡¬t
();

94 
BlockReque¡R—dS‹_V”ifySeùÜS‘
:

96 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
»que¡
.
	`g‘Regi¡”Reque¡
();

98 ià(
»gi¡”Reque¡
->
	`uštV®
(è=ğ
m_block
->
	`add»ss
())

100 
m_»adS‹
 = 
BlockReque¡R—dS‹_SeùÜS‘
;

101 
m_tim”
.
	`»¡¬t
();

106 
BlockReque¡R—dS‹_SeùÜS‘
:

108 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
»que¡
.
	`g‘Regi¡”Reque¡
();

110 ià(
m_block
->
	`isP¬am‘”S‘
(è&& 
»gi¡”Reque¡
->
	`uštV®
(è=ğ
DEVICE_STATE_MODIFY_DATA
)

112 
m_»adS‹
 = 
BlockReque¡R—dS‹_R—dR—dy
;

113 
m_tim”
.
	`»¡¬t
();

115 ià(!
m_block
->
	`isP¬am‘”S‘
(è&& 
»gi¡”Reque¡
->
	`uštV®
(è=ğ
DEVICE_STATE_TRANSIENT
)

117 
m_»adS‹
 = 
BlockReque¡R—dS‹_T¿ns›Á
;

118 
m_tim”
.
	`»¡¬t
();

123 
BlockReque¡R—dS‹_T¿ns›Á
:

125 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
»que¡
.
	`g‘Regi¡”Reque¡
();

126 ià(
»gi¡”Reque¡
->
	`uštV®
() == 0x00 ||„egisterRequest->uintVal() == 0x01)

128 
m_»adS‹
 = 
BlockReque¡R—dS‹_R—dR—dy
;

129 
m_tim”
.
	`»¡¬t
();

134 
BlockReque¡R—dS‹_R—dR—dy
:

136 
BlockReque¡
 *
blockReque¡
 = 
»que¡
.
	`g‘BlockReque¡
();

137 
m_d©a
 = 
	`QBy‹A¼ay
(
blockReque¡
->
	`d©a
());

138 
m_»adS‹
 = 
BlockReque¡R—dS‹_R—d
;

142 
BlockReque¡R—dS‹_R—d
:

144 
m_»adS‹
 = 
BlockReque¡R—dS‹_Aá”R—d
;

150 
	`Q_ASSERT
(0);

154 
	}
}

156 
SomeReque¡
 
	gBlockReque¡Machše
::
	$»adAùiÚ
()

158 
	`Q_ASSERT
(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_R—d
);

160 
m_»adS‹
)

163 
BlockReque¡R—dS‹_In™Ÿl
:

169 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_Wr™e
, 
m_d©aT¿nsãrIn™Regi¡”
->
	`add»ss
(), 
this
);

170 
»gi¡”Reque¡
->
	`£tD©a
(
m_block
->
	`add»ss
());

171 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

172 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚWr™eDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

173 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

174  
	`SomeReque¡
(
»gi¡”Reque¡
);

177 
BlockReque¡R—dS‹_V”ifySeùÜS‘
:

180 ià(
m_tim”
.
	`–­£d
() < 500)

182 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_R—d
, 
m_d©aT¿nsãrIn™Regi¡”
->
	`add»ss
(), 
this
);

183 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

184 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

185 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

186  
	`SomeReque¡
(
»gi¡”Reque¡
);

190 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

191  
	`SomeReque¡
();

195 
BlockReque¡R—dS‹_SeùÜS‘
:

198 ià(
m_tim”
.
	`–­£d
() < 500)

200 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_R—d
, 
m_sy¡emO³¿tšgS‹Regi¡”
->
	`add»ss
(), 
this
);

201 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

202 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

203 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

204  
	`SomeReque¡
(
»gi¡”Reque¡
);

208 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

209  
	`SomeReque¡
();

213 
BlockReque¡R—dS‹_T¿ns›Á
:

216 ià(
m_tim”
.
	`–­£d
() < 10000)

218 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_R—d
, 
m_sy¡emO³¿tšgS‹Regi¡”
->
	`add»ss
(), 
this
);

219 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

220 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

221 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

222  
	`SomeReque¡
(
»gi¡”Reque¡
);

226 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

227  
	`SomeReque¡
();

231 
BlockReque¡R—dS‹_R—dR—dy
:

234 
BlockReque¡
 *
blockReque¡
 = 
Ãw
 
	`BlockReque¡
(
m_»que¡Ty³
, 
m_block
->
	`add»ss
(), m_block->
	`off£t
(), m_block->
	`numb”OfRegi¡”s
(), 
this
);

235 
	`cÚÃù
(
blockReque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
BlockReque¡
*)), 
this
, 
	`SLOT
(
	`blockReque¡D–‘e
(BlockRequest*)));

236 
	`cÚÃù
(
blockReque¡
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
BlockReque¡
*)), 
this
, 
	`SLOT
(
	`blockReque¡DÚe
(BlockReque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

237 
	`cÚÃù
(
blockReque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
BlockReque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`blockReque¡E¼Ü
(BlockReque¡*,»que¡_”rÜ_t)), 
Qt
::
DœeùCÚÃùiÚ
);

238  
	`SomeReque¡
(
blockReque¡
);

241 
BlockReque¡R—dS‹_R—d
:

244 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_Wr™e
, 
m_d©aT¿nsãrIn™Regi¡”
->
	`add»ss
(), 
this
);

245 
»gi¡”Reque¡
->
	`£tD©a
(0);

246 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

247 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚWr™eDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

248 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

249  
	`SomeReque¡
(
»gi¡”Reque¡
);

252 
BlockReque¡R—dS‹_Aá”R—d
:

254 
em™
 
	`ÚR—dDÚe
(
this
);

255  
	`SomeReque¡
();

258 
BlockReque¡R—dS‹_E¼Ü
:

261 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_UNKNOWN
);

262  
	`SomeReque¡
();

266 
	`Q_ASSERT
(0);

269  
	`SomeReque¡
();

270 
	}
}

272 
	gBlockReque¡Machše
::
	$wr™eT¿ns™iÚ
(
SomeReque¡
 
»que¡
)

274 
	`Q_ASSERT
(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
);

276 
m_wr™eS‹
)

279 
BlockReque¡Wr™eS‹_In™Ÿl
:

281 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_S‘upS‘
;

282 
m_tim”
.
	`¡¬t
();

286 
BlockReque¡Wr™eS‹_S‘upS‘
:

288 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
»que¡
.
	`g‘Regi¡”Reque¡
();

289 ià(
»gi¡”Reque¡
->
	`uštV®
(è=ğ
DEVICE_STATE_DOWNLOAD_DATA
)

291 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_DowÆßdR—dy
;

292 
m_tim”
.
	`»¡¬t
();

297 
BlockReque¡Wr™eS‹_DowÆßdR—dy
:

299 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_DowÆßdDÚe
;

303 
BlockReque¡Wr™eS‹_DowÆßdDÚe
:

305 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
»que¡
.
	`g‘Regi¡”Reque¡
();

306 ià(
»gi¡”Reque¡
->
	`uštV®
() == 0x00 ||„egisterRequest->uintVal() == 0x01)

308 ià(
m_block
->
	`isRAM
())

310 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_Wr™‹n
;

314 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_IdË
;

316 
m_tim”
.
	`»¡¬t
();

321 
BlockReque¡Wr™eS‹_IdË
:

323 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_Wr™eToFÏsh
;

324 
m_tim”
.
	`»¡¬t
();

328 
BlockReque¡Wr™eS‹_Wr™eToFÏsh
:

330 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
»que¡
.
	`g‘Regi¡”Reque¡
();

331 ià(
»gi¡”Reque¡
->
	`uštV®
(è=ğ
DEVICE_STATE_SAVE_DATA
)

333 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_Savšg
;

334 
m_tim”
.
	`»¡¬t
();

339 
BlockReque¡Wr™eS‹_Savšg
:

341 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
»que¡
.
	`g‘Regi¡”Reque¡
();

342 ià(
»gi¡”Reque¡
->
	`uštV®
() == 0x00 ||„egisterRequest->uintVal() == 0x01)

344 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_Wr™‹n
;

346 
m_tim”
.
	`»¡¬t
();

350 
BlockReque¡Wr™eS‹_Wr™‹n
:

352 
m_wr™eS‹
 = 
BlockReque¡Wr™eS‹_Aá”Wr™e
;

358 
	`Q_ASSERT
(0);

362 
	}
}

364 
SomeReque¡
 
	gBlockReque¡Machše
::
	$wr™eAùiÚ
()

366 
	`Q_ASSERT
(
m_»que¡Ty³
 =ğ
BlockReque¡Ty³_Wr™e
);

368 
m_wr™eS‹
)

371 
BlockReque¡Wr™eS‹_In™Ÿl
:

374 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_Wr™e
, 
m_d©aT¿nsãrIn™Regi¡”
->
	`add»ss
(), 
this
);

375 
»gi¡”Reque¡
->
	`£tD©a
((
m_block
->
	`add»ss
(è& 0xFFè| ((
m_d©a
.
	`Ëngth
() / 4) << 8));

376 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

377 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚWr™eDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

378 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

379  
	`SomeReque¡
(
»gi¡”Reque¡
);

382 
BlockReque¡Wr™eS‹_S‘upS‘
:

385 ià(
m_tim”
.
	`–­£d
() < 10000)

387 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_R—d
, 
m_sy¡emO³¿tšgS‹Regi¡”
->
	`add»ss
(), 
this
);

388 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

389 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

390 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

391  
	`SomeReque¡
(
»gi¡”Reque¡
);

395 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

396  
	`SomeReque¡
();

400 
BlockReque¡Wr™eS‹_DowÆßdR—dy
:

403 
BlockReque¡
 *
blockReque¡
 = 
Ãw
 
	`BlockReque¡
(
m_»que¡Ty³
, 
m_block
->
	`add»ss
(), m_block->
	`off£t
(), m_block->
	`numb”OfRegi¡”s
(), 
this
);

404 
blockReque¡
->
	`£tD©a
(
m_d©a
);

405 
	`cÚÃù
(
blockReque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
BlockReque¡
*)), 
this
, 
	`SLOT
(
	`blockReque¡D–‘e
(BlockRequest*)));

406 
	`cÚÃù
(
blockReque¡
, 
	`SIGNAL
(
	`ÚWr™eDÚe
(
BlockReque¡
*)), 
this
, 
	`SLOT
(
	`blockReque¡DÚe
(BlockReque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

407 
	`cÚÃù
(
blockReque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
BlockReque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`blockReque¡E¼Ü
(BlockReque¡*,»que¡_”rÜ_t)), 
Qt
::
DœeùCÚÃùiÚ
);

408  
	`SomeReque¡
(
blockReque¡
);

411 
BlockReque¡Wr™eS‹_DowÆßdDÚe
:

414 ià(
m_tim”
.
	`–­£d
() < 10000)

416 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_R—d
, 
m_sy¡emO³¿tšgS‹Regi¡”
->
	`add»ss
(), 
this
);

417 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

418 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

419 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

420  
	`SomeReque¡
(
»gi¡”Reque¡
);

424 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

425  
	`SomeReque¡
();

429 
BlockReque¡Wr™eS‹_IdË
:

432 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_Wr™e
, 
m_d©aBlockDe¡š©iÚRegi¡”
->
	`add»ss
(), 
this
);

433 
»gi¡”Reque¡
->
	`£tD©a
((
m_block
->
	`add»ss
(è& 0xFFè| ((
m_d©a
.
	`Ëngth
() / 4) << 8));

434 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

435 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚWr™eDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

436 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

437  
	`SomeReque¡
(
»gi¡”Reque¡
);

440 
BlockReque¡Wr™eS‹_Wr™eToFÏsh
:

443 ià(
m_tim”
.
	`–­£d
() < 500)

445 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_R—d
, 
m_sy¡emO³¿tšgS‹Regi¡”
->
	`add»ss
(), 
this
);

446 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

447 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

448 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

449  
	`SomeReque¡
(
»gi¡”Reque¡
);

453 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

454  
	`SomeReque¡
();

458 
BlockReque¡Wr™eS‹_Savšg
:

461 ià(
m_tim”
.
	`–­£d
() < 10000)

463 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_R—d
, 
m_sy¡emO³¿tšgS‹Regi¡”
->
	`add»ss
(), 
this
);

464 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

465 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚR—dDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

466 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

467  
	`SomeReque¡
(
»gi¡”Reque¡
);

471 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

472  
	`SomeReque¡
();

476 
BlockReque¡Wr™eS‹_Wr™‹n
:

479 
Regi¡”Reque¡
 *
»gi¡”Reque¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_Wr™e
, 
m_d©aT¿nsãrIn™Regi¡”
->
	`add»ss
(), 
this
);

480 
»gi¡”Reque¡
->
	`£tD©a
(0);

481 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡D–‘e
(RegisterRequest*)));

482 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚWr™eDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡DÚe
(Regi¡”Reque¡*)), 
Qt
::
DœeùCÚÃùiÚ
);

483 
	`cÚÃù
(
»gi¡”Reque¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*,
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`»gi¡”Reque¡E¼Ü
(RegisterRequest*,request_error_t)));

484  
	`SomeReque¡
(
»gi¡”Reque¡
);

487 
BlockReque¡Wr™eS‹_Aá”Wr™e
:

489 
em™
 
	`ÚWr™eDÚe
(
this
);

490  
	`SomeReque¡
();

493 
BlockReque¡Wr™eS‹_E¼Ü
:

495 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_UNKNOWN
);

496  
	`SomeReque¡
();

500 
	`Q_ASSERT
(0);

503  
	`SomeReque¡
();

504 
	}
}

	@block_request_machine.h

1 #iâdeà
BLOCK_REQUEST_MACHINE_H


2 
	#BLOCK_REQUEST_MACHINE_H


	)

4 
	~<QObjeù
>

5 
	~<QTime
>

7 
	~"mod–/block.h
"

8 
	~"mod–/»que¡.h
"

9 
	~"mod–/»gi¡”s_m­.h
"

11 
şass
 
	gBlock
;

13 
	gBlockReque¡R—dS‹
 : 
ušt8_t


15 
BlockReque¡R—dS‹_In™Ÿl
,

16 
	gBlockReque¡R—dS‹_V”ifySeùÜS‘
,

17 
	gBlockReque¡R—dS‹_SeùÜS‘
,

18 
	gBlockReque¡R—dS‹_T¿ns›Á
,

19 
	gBlockReque¡R—dS‹_R—dR—dy
,

20 
	gBlockReque¡R—dS‹_R—d
,

21 
	gBlockReque¡R—dS‹_Aá”R—d
,

22 
	gBlockReque¡R—dS‹_E¼Ü


25 
	gBlockReque¡Wr™eS‹
 : 
ušt8_t


27 
BlockReque¡Wr™eS‹_In™Ÿl
,

28 
	gBlockReque¡Wr™eS‹_S‘upS‘
,

29 
	gBlockReque¡Wr™eS‹_DowÆßdR—dy
,

30 
	gBlockReque¡Wr™eS‹_DowÆßdDÚe
,

31 
	gBlockReque¡Wr™eS‹_IdË
,

32 
	gBlockReque¡Wr™eS‹_Wr™eToFÏsh
,

33 
	gBlockReque¡Wr™eS‹_Savšg
,

34 
	gBlockReque¡Wr™eS‹_Wr™‹n
,

35 
	gBlockReque¡Wr™eS‹_Aá”Wr™e
,

36 
	gBlockReque¡Wr™eS‹_E¼Ü


39 şas 
	cBlockReque¡Machše
 : 
public
 
QObjeù


41 
Q_OBJECT


42 
public
:

43 
ex¶ic™
 
BlockReque¡Machše
(
BlockReque¡Ty³
 
ty³
, 
Block
* 
block
, 
Regi¡”sM­
 *
»gi¡”s
, 
QObjeù
 *
·»Á
 = 0);

44 
SomeReque¡
 
g‘Reque¡
();

45 
QBy‹A¼ay
 
	$d©a
(ècÚ¡ {  
this
->
m_d©a
; }

46 
	$£tD©a
(
QBy‹A¼ay
 
d©a
è{ 
this
->
m_d©a
 = d©a; 
	}
}

48 
	g´iv©e
:

49 
SomeReque¡
 
»adAùiÚ
();

50 
»adT¿ns™iÚ
(
SomeReque¡
);

51 
SomeReque¡
 
wr™eAùiÚ
();

52 
wr™eT¿ns™iÚ
(
SomeReque¡
);

54 
	gsigÇls
:

55 
ÚR—dDÚe
(
BlockReque¡Machše
 *);

56 
ÚWr™eDÚe
(
BlockReque¡Machše
 *);

57 
ÚE¼Ü
(
BlockReque¡Machše
 *, 
»que¡_”rÜ_t
 
”rÜCode
);

59 
´iv©e
 
	g¦Ùs
:

60 
»gi¡”Reque¡DÚe
(
Regi¡”Reque¡
 *
»que¡
);

61 
»gi¡”Reque¡D–‘e
(
Regi¡”Reque¡
 *
»que¡
);

62 
»gi¡”Reque¡E¼Ü
(
Regi¡”Reque¡
 *
»que¡
, 
»que¡_”rÜ_t
 
”rCode
);

64 
blockReque¡DÚe
(
BlockReque¡
 *
»que¡
);

65 
blockReque¡D–‘e
(
BlockReque¡
 *
»que¡
);

66 
blockReque¡E¼Ü
(
BlockReque¡
 *
»que¡
, 
»que¡_”rÜ_t
 
”rCode
);

68 
	g´iv©e
:

69 
Block
 *
m_block
;

70 
BlockReque¡Ty³
 
	gm_»que¡Ty³
;

71 
QBy‹A¼ay
 
	gm_d©a
;

75 
BlockReque¡R—dS‹
 
	gm_»adS‹
;

76 
BlockReque¡Wr™eS‹
 
	gm_wr™eS‹
;

79 
Regi¡”
* 
	gm_d©aT¿nsãrIn™Regi¡”
;

80 
Regi¡”
* 
	gm_d©aBlockDe¡š©iÚRegi¡”
;

81 
Regi¡”
* 
	gm_deviûO³¿tšgS‹Regi¡”
;

82 
Regi¡”
* 
	gm_sy¡emO³¿tšgS‹Regi¡”
;

84 
QTime
 
	gm_tim”
;

	@blocks_map.cpp

1 
	~"mod–/blocks_m­.h
"

3 
	~<QSŒšgLi¡
>

4 
	~<QFe
>

5 
	~<QTextSŒ—m
>

7 
	gBlocksM­
::
	$BlocksM­
(
CommuniÿtÜ
* 
communiÿtÜ
, 
Regi¡”sM­
* 
»gi¡”s
) :

8 
	`m_communiÿtÜ
(
communiÿtÜ
), 
	$m_»gi¡”s
(
»gi¡”s
)

10 
	}
}

12 
boŞ
 
	gBlocksM­
::
	$lßdFromFe
(
QSŒšg
 
f•©h
)

14 
QFe
 
	`fe
(
f•©h
);

15 ià(!
fe
.
	`İ’
(
QIODeviû
::
R—dOÆy
))

16  
çl£
;

18 
QTextSŒ—m
 
	`¡»am
(&
fe
);

20 !
¡»am
.
	`©End
())

23 
QSŒšg
 
lše
 = 
¡»am
.
	`»adLše
();

25 ià(
lše
.
	`isEm±y
()) ;

26 ià(
lše
.
	`¡¬tsW™h
("//") ||†ine.startsWith("#")) ;

28 
QSŒšgLi¡
 
f›lds
 = 
lše
.
	`¥l™
(",");

29 ià(
f›lds
.
	`couÁ
() == 4)

31 
Block
* 
blk
 = 
Ãw
 
	`Block
(

32 
m_communiÿtÜ
,

33 
m_»gi¡”s
,

34  
f›lds
.
	`©
(0),

35  
f›lds
.
	`©
(1).
	`toUIÁ
(),

36  
f›lds
.
	`©
(2).
	`toUIÁ
(),

37  
f›lds
.
	`©
(3).
	`toUIÁ
()

40 
blocksByName
.
	`š£¹
(
blk
->
	`Çme
(), blk);

44  
çl£
;

48  
Œue
;

49 
	}
}

51 
	gBlocksM­
::~
	$BlocksM­
()

53 
QM­
<
QSŒšg
, 
Block
*>::
™”©Ü
 iterator;

54 
™”©Ü
 = 
blocksByName
.
	`begš
(); i‹¿tÜ !ğblocksByName.
	`’d
(); iterator++)

56 
d–‘e
 
™”©Ü
.
	`v®ue
();

58 
	}
}

60 
Block
* 
	gBlocksM­
::
	$g‘
(
QSŒšg
 
Çme
)

62  
blocksByName
[
Çme
];

63 
	}
}

	@blocks_map.h

1 #iâdeà
BLOCKSMAP_H


2 
	#BLOCKSMAP_H


	)

4 
	~<QSŒšg
>

5 
	~<QM­
>

7 
	~"mod–/communiÿtÜ.h
"

8 
	~"mod–/block.h
"

10 
	sBlocksM­


12 
	mpublic
:

13 
ex¶ic™
 
BlocksM­
(
CommuniÿtÜ
* 
communiÿtÜ
, 
Regi¡”sM­
* 
»gi¡”s
);

14 ~
BlocksM­
();

16 
boŞ
 
lßdFromFe
(
QSŒšg
 
f•©h
);

17 
Block
* 
g‘
(
QSŒšg
 
Çme
);

20 
	mQM­
<
	mQSŒšg
, 
	mBlock
*> 
	mblocksByName
;

22 
	m´iv©e
:

23 
CommuniÿtÜ
* 
m_communiÿtÜ
;

24 
Regi¡”sM­
* 
	mm_»gi¡”s
;

	@card_scanner.cpp

1 
	~"mod–/ÿrd_sÿÂ”.h
"

2 
	~"d©a/d©a.h
"

4 
	gC¬dSÿÂ”
::
	$C¬dSÿÂ”
(
QObjeù
 *
·»Á
è: 
	$QObjeù
(
·»Á
)

6 
m_sock‘
 = 
Ãw
 
	`QUdpSock‘
(
this
);

7 
	`cÚÃù
(
m_sock‘
, 
	`SIGNAL
(
	`»adyR—d
()), 
this
, 
	`SLOT
(
	`ÚD©aReûivedUDP
()));

8 
m_sock‘
->
	`bšd
(
QHo¡Add»ss
::
Any
, 7756);

10 
m_tim”
 = 
Ãw
 
	`QTim”
(
this
);

11 
	`cÚÃù
(
m_tim”
, 
	`SIGNAL
(
	`timeout
()), 
this
, 
	`SLOT
(
	`ÚTimeout
()));

12 
	}
}

14 
	gC¬dSÿÂ”
::~
	$C¬dSÿÂ”
()

16 
	}
}

18 
C¬dSÿÂ”
::
	$ÚTimeout
()

20 
em™
 
	`ÚSÿnDÚe
();

21 
	}
}

23 
	gC¬dSÿÂ”
::
	$sÿn
(
QN‘wÜkIÁ”çû
 
š‹rçû
)

25 
‹¡D©ag¿m
[10];

26 
ušt16_t
 
¡©us
 = 0x0000;

27 
ušt16_t
 
ty³
 = 0x0001;

28 
ušt16_t
 
add»ss
 = 0x4022;

29 
ušt32_t
 
d©a
 = 0x00000000;

31 
	`memıy
(
‹¡D©ag¿m
 + 0, &
¡©us
 , 2);

32 
	`memıy
(
‹¡D©ag¿m
 + 2, &
ty³
 , 2);

33 
	`memıy
(
‹¡D©ag¿m
 + 4, &
add»ss
, 2);

34 
	`memıy
(
‹¡D©ag¿m
 + 6, &
d©a
 , 4);

36 
	`fÜ—ch
 (
QN‘wÜkAdd»ssEÁry
 
’Œy
, 
š‹rçû
.
	`add»ssEÁr›s
())

38 
QHo¡Add»ss
 
add»ss
 = 
’Œy
.
	`brßdÿ¡
();

39 
m_sock‘
->
	`wr™eD©ag¿m
(
‹¡D©ag¿m
, Ñe¡D©ag¿m), 
add»ss
, 
DEFAULT_CONTROLLER_PORT
);

42 
m_tim”
->
	`¡¬t
(1000);

43 
	}
}

45 
	gC¬dSÿÂ”
::
	$ÚD©aReûivedUDP
()

47 
m_sock‘
->
	`hasP’dšgD©ag¿ms
())

49 
QHo¡Add»ss
 
£nd”
;

50 
qušt16
 
£nd”PÜt
;

52 
bufãr
[128];

53 
qšt64
 
»adSize
 = 
m_sock‘
->
	`»adD©ag¿m
(
bufãr
, (bufãr), &
£nd”
, &
£nd”PÜt
);

54 ià(
»adSize
 == 10)

56 
ušt16_t
 
add»ss
 = 0x4022;

57 ià(
	`memcmp
(
bufãr
 + 4, &
add»ss
, 2) == 0)

58 
em™
 
	`ÚC¬dFound
(
£nd”
.
	`toSŒšg
());

61 
	}
}

	@card_scanner.h

1 #iâdeà
CARDSCANNER_H


2 
	#CARDSCANNER_H


	)

4 
	~<QObjeù
>

5 
	~<QN‘wÜkIÁ”çû
>

6 
	~<QUdpSock‘
>

7 
	~<QTim”
>

9 şas 
	cC¬dSÿÂ”
 : 
public
 
QObjeù


11 
Q_OBJECT


13 
public
:

14 
ex¶ic™
 
C¬dSÿÂ”
(
QObjeù
 *
·»Á
 = 0);

15 ~
C¬dSÿÂ”
();

17 
	msigÇls
:

18 
ÚC¬dFound
(
QSŒšg
 
IP
);

19 
ÚSÿnDÚe
();

21 
public
 
	m¦Ùs
:

22 
sÿn
(
QN‘wÜkIÁ”çû
);

24 
´iv©e
 
	m¦Ùs
:

25 
ÚD©aReûivedUDP
();

26 
ÚTimeout
();

28 
	m´iv©e
:

29 
QUdpSock‘
 *
m_sock‘
;

30 
QTim”
 *
	mm_tim”
;

	@communicator.cpp

1 
	~<QUdpSock‘
>

3 
	~"mod–/communiÿtÜ.h
"

5 
	gCommuniÿtÜ
::
	$CommuniÿtÜ
(
QSŒšg
 

, 
pÜt
, 
QObjeù
 *
·»Á
) :

6 
	`QObjeù
(
·»Á
), 
	`m_
(

), 
	`m_pÜt
(
pÜt
), 
	`m_timeoutCouÁ
(0), 
	$m_äÚtProûs£d
(
çl£
)

8 
m_udpSock‘
 = 
Ãw
 
	`QUdpSock‘
(
this
);

9 
	`cÚÃù
(
m_udpSock‘
, 
	`SIGNAL
(
	`»adyR—d
()), 
this
, 
	`SLOT
(
	`ÚD©aReûivedUDP
()));

10 
m_udpSock‘
->
	`bšd
(
QHo¡Add»ss
::
Any
, 7755);

12 
m_tıSock‘
 = 
Ãw
 
	`QTıSock‘
(
this
);

13 
	`cÚÃù
(
m_tıSock‘
, 
	`SIGNAL
(
	`»adyR—d
()), 
this
, 
	`SLOT
(
	`ÚD©aReûivedTCP
()));

14 
m_tıSock‘
->
	`cÚÃùToHo¡
(
	`QHo¡Add»ss
(
m_
), 
m_pÜt
);

16 
m_timeoutTim”
 = 
Ãw
 
	`QTim”
(
this
);

17 
m_timeoutTim”
->
	`£tSšgËShÙ
(
Œue
);

18 
	`cÚÃù
(
m_timeoutTim”
, 
	`SIGNAL
(
	`timeout
()), 
this
, 
	`SLOT
(
	`ÚTimeout
()));

19 
	}
}

21 
	gCommuniÿtÜ
::
	$»cÚÃù
()

23 ià(
m_udpSock‘
è
d–‘e
 m_udpSocket;

25 
m_udpSock‘
 = 
Ãw
 
	`QUdpSock‘
(
this
);

26 
	`cÚÃù
(
m_udpSock‘
, 
	`SIGNAL
(
	`»adyR—d
()), 
this
, 
	`SLOT
(
	`ÚD©aReûivedUDP
()));

27 
m_udpSock‘
->
	`bšd
(
QHo¡Add»ss
::
Any
, 7755);

29 ià(
m_tıSock‘
è
d–‘e
 m_tcpSocket;

31 
m_tıSock‘
 = 
Ãw
 
	`QTıSock‘
(
this
);

32 
	`cÚÃù
(
m_tıSock‘
, 
	`SIGNAL
(
	`»adyR—d
()), 
this
, 
	`SLOT
(
	`ÚD©aReûivedTCP
()));

33 
m_tıSock‘
->
	`cÚÃùToHo¡
(
	`QHo¡Add»ss
(
m_
), 
m_pÜt
);

34 
	}
}

36 
	gCommuniÿtÜ
::
	$queueReque¡
(
SomeReque¡
 
»que¡
)

38 
boŞ
 
´oûssNext
 = 
m_»que¡s
.
	`em±y
();

40 
m_»que¡s
.
	`’queue
(
»que¡
);

41 ià(
´oûssNext
è
this
->
	`´oûssH—d
();

42 
	}
}

44 
	gCommuniÿtÜ
::
	$ÚD©aReûivedUDP
()

46 
m_udpSock‘
->
	`hasP’dšgD©ag¿ms
())

48 
m_timeoutCouÁ
 = 0;

49 
m_timeoutTim”
->
	`¡İ
();

51 ià(
m_»que¡s
.
	`em±y
(è|| m_»que¡s.
	`äÚt
().
	`ty³
(è!ğ
SomeReque¡Ty³_Regi¡”
)

53 
QHo¡Add»ss
 
£nd”
;

54 
qušt16
 
£nd”PÜt
;

55 
bbufãr
[2048];

56 
qšt64
 
»adSize
 = 
m_udpSock‘
->
	`»adD©ag¿m
(
bbufãr
, (bbufãr), &
£nd”
, &
£nd”PÜt
);

57 
	`qW¬nšg
("Reûived UDP d©¨whnÙƒx³ùšg‡ny (sizğ%Îd)", 
»adSize
);

62 
Regi¡”Reque¡
* 
»que¡
 = 
m_»que¡s
.
	`dequeue
().
	`g‘Regi¡”Reque¡
();

63 
m_äÚtProûs£d
 = 
çl£
;

65 
QHo¡Add»ss
 
£nd”
;

66 
qušt16
 
£nd”PÜt
;

68 
bufãr
[2048];

69 
qšt64
 
»adSize
 = 
m_udpSock‘
->
	`»adD©ag¿m
(
bufãr
, (bufãr), &
£nd”
, &
£nd”PÜt
);

70 
	`Q_ASSERT
(
»adSize
 =ğ
»que¡
->
	`»maššgBy‹s
());

72 
SomeReque¡
 
ÃxtReque¡
 = 
»que¡
->
	`hªdËRe¥Ú£
(
bufãr
, 
»adSize
);

73 ià(
ÃxtReque¡
.
	`ty³
(è!ğ
SomeReque¡Ty³_NÚe
)

75 
m_»que¡s
.
	`push_äÚt
(
ÃxtReque¡
);

76 
m_äÚtProûs£d
 = 
çl£
;

80 ià(!
m_»que¡s
.
	`em±y
()è
this
->
	`´oûssH—d
();

81 
	}
}

83 
	gCommuniÿtÜ
::
	$ÚD©aReûivedTCP
()

85 
m_tıSock‘
->
	`by‹sAvaabË
())

87 
m_timeoutCouÁ
 = 0;

88 
m_timeoutTim”
->
	`¡İ
();

90 ià(
m_»que¡s
.
	`em±y
(è|| m_»que¡s.
	`äÚt
().
	`ty³
(è!ğ
SomeReque¡Ty³_Block
)

92 
bufãr
[2048];

93 
qšt64
 
by‹sR—d
 = 
m_tıSock‘
->
	`»ad
(
bufãr
, (buffer));

94 
	`qW¬nšg
("Reûived TCP d©¨whnÙƒx³ùšg‡ny (sizğ%Îd)", 
by‹sR—d
);

99 
BlockReque¡
* 
»que¡
 = 
m_»que¡s
.
	`äÚt
().
	`g‘BlockReque¡
();

101 
bufãr
[2048];

102 
qšt64
 
by‹sRemaššg
 = 
»que¡
->
	`»maššgBy‹s
();

103 
qšt64
 
by‹sR—d
 = 
m_tıSock‘
->
	`»ad
(
bufãr
, (bufãrè> (
size_t
è
by‹sRemaššg
 ? bytesRemaining : (buffer));

104 
»que¡
->
	`­³ndBy‹s
(
bufãr
, 
by‹sR—d
);

105 
by‹sRemaššg
 -ğ
by‹sR—d
;

107 ià(
by‹sRemaššg
 == 0)

110 
m_»que¡s
.
	`dequeue
();

111 
m_äÚtProûs£d
 = 
çl£
;

113 
SomeReque¡
 
ÃxtReque¡
 = 
»que¡
->
	`hªdËRe¥Ú£
();

114 ià(
ÃxtReque¡
.
	`ty³
(è!ğ
SomeReque¡Ty³_NÚe
)

116 
m_»que¡s
.
	`push_äÚt
(
ÃxtReque¡
);

117 
m_äÚtProûs£d
 = 
çl£
;

120 ià(!
m_»que¡s
.
	`em±y
()è
this
->
	`´oûssH—d
();

129 
m_timeoutTim”
->
	`¡¬t
(
m_»que¡s
.
	`äÚt
().
	`timeout
());

132 
	}
}

134 
	gCommuniÿtÜ
::
	$´oûssH—d
()

136 
SomeReque¡
 
»que¡
 = 
m_»que¡s
.
	`h—d
();

137 ià(
m_äÚtProûs£d
) ;

138 
m_äÚtProûs£d
 = 
Œue
;

140 ià(
»que¡
.
	`ty³
(è=ğ
SomeReque¡Ty³_Regi¡”
)

142 
Regi¡”Reque¡
* 
»gi¡”Reque¡
 = 
»que¡
.
	`g‘Regi¡”Reque¡
();

143 * 
mes§ge
 = 
»gi¡”Reque¡
->
	`g‘Mes§ge
();

144 
m_udpSock‘
->
	`wr™eD©ag¿m
(
mes§ge
, 
»gi¡”Reque¡
->
	`mes§geL’gth
(), 
	`QHo¡Add»ss
(
m_
), 
m_pÜt
);

145 
»gi¡”Reque¡
->
	`ä“Mes§ge
(
mes§ge
);

147 ià(
»que¡
.
	`ty³
(è=ğ
SomeReque¡Ty³_Block
)

149 
BlockReque¡
* 
blockReque¡
 = 
»que¡
.
	`g‘BlockReque¡
();

151 
qšt64
 
mes§geL’gth
 = 
blockReque¡
->
	`mes§geL’gth
();

152 
qšt64
 
by‹sS’t
 = 0;

154 * 
mes§ge
 = 
blockReque¡
->
	`g‘Mes§ge
();

156 
by‹sS’t
 < 
mes§geL’gth
)

158 
qšt64
 
»suÉ
 = 
m_tıSock‘
->
	`wr™e
(
mes§ge
 + 
by‹sS’t
, 
mes§geL’gth
 - bytesSent);

159 ià(
»suÉ
 == -1)

162 
	`Q_ASSERT
(
»suÉ
 != -1);

166 
by‹sS’t
 +ğ
»suÉ
;

170 
blockReque¡
->
	`ä“Mes§ge
(
mes§ge
);

171 ià(
blockReque¡
->
	`»maššgBy‹s
() == 0)

173 
m_»que¡s
.
	`dequeue
();

174 
m_äÚtProûs£d
 = 
çl£
;

176 
SomeReque¡
 
ÃxtReque¡
 = 
blockReque¡
->
	`hªdËRe¥Ú£
();

177 ià(
ÃxtReque¡
.
	`ty³
(è!ğ
SomeReque¡Ty³_NÚe
)

179 
m_»que¡s
.
	`push_äÚt
(
ÃxtReque¡
);

180 
m_äÚtProûs£d
 = 
çl£
;

183 ià(!
this
->
m_»que¡s
.
	`em±y
()èthis->
	`´oûssH—d
();

189 
	`Q_ASSERT
(0);

192 
m_timeoutTim”
->
	`¡¬t
(
»que¡
.
	`timeout
());

193 
	}
}

195 
	gCommuniÿtÜ
::
	$ÚTimeout
()

198 
SomeReque¡
 
»que¡
 = 
m_»que¡s
.
	`dequeue
();

199 
m_äÚtProûs£d
 = 
çl£
;

201 ià(
»que¡
.
	`ty³
(è=ğ
SomeReque¡Ty³_Regi¡”
)

203 
»que¡
.
	`g‘Regi¡”Reque¡
()->
	`ÚTimeout
();

205 ià(
»que¡
.
	`ty³
(è=ğ
SomeReque¡Ty³_Block
)

207 
»que¡
.
	`g‘BlockReque¡
()->
	`ÚTimeout
();

210 
m_timeoutCouÁ
++;

212 ià(
m_timeoutCouÁ
 =ğ
TIMEOUT_THRESHOLD
)

214 
	`»cÚÃù
();

215 
m_timeoutCouÁ
 = 0;

218 ià(!
m_»que¡s
.
	`em±y
()è
this
->
	`´oûssH—d
();

219 
	}
}

	@communicator.h

1 #iâdeà
COMMUNICATOR_H


2 
	#COMMUNICATOR_H


	)

4 
	~<QObjeù
>

5 
	~<QQueue
>

6 
	~<QUdpSock‘
>

7 
	~<QTıSock‘
>

8 
	~<QTim”
>

10 
	~"mod–/»que¡.h
"

12 
	#TIMEOUT_THRESHOLD
 3

	)

14 şas 
	cCommuniÿtÜ
 : 
public
 
QObjeù


16 
Q_OBJECT


18 
public
:

19 
ex¶ic™
 
CommuniÿtÜ
(
QSŒšg
 

, 
pÜt
, 
QObjeù
 *
·»Á
 = 0);

21 
queueReque¡
(
SomeReque¡
 
»que¡
);

22 
»cÚÃù
();

24 
QSŒšg
 
	$cÚŒŞËrIP
(ècÚ¡ {  
m_
; }

25 
	$cÚŒŞËrPÜt
(ècÚ¡ {  
m_pÜt
; 
	}
}

27 
	gsigÇls
:

29 
public
 
¦Ùs
:

31 
´iv©e
 
¦Ùs
:

32 
ÚD©aReûivedUDP
();

33 
ÚD©aReûivedTCP
();

34 
ÚTimeout
();

36 
	g´iv©e
:

37 
´oûssH—d
();

39 
QSŒšg
 
	gm_
;

40 
	gm_pÜt
;

41 
	gm_timeout
;

43 
	gQQueue
<
	gSomeReque¡
> 
	gm_»que¡s
;

44 
QUdpSock‘
 *
	gm_udpSock‘
;

45 
QTıSock‘
 *
	gm_tıSock‘
;

46 
QTim”
* 
	gm_timeoutTim”
;

47 
	gm_timeoutCouÁ
;

48 
boŞ
 
	gm_äÚtProûs£d
;

	@cscope.files

1 
	gblock
.
ıp


2 
	gblock_»que¡
.
ıp


3 
	gblock_»que¡_machše
.
ıp


4 
	gblocks_m­
.
ıp


5 
	gÿrd_sÿÂ”
.
ıp


6 
	gcommuniÿtÜ
.
ıp


7 
	gçuÉs_m­
.
ıp


8 
	gglob®_¡©e_machše
.
ıp


9 
	g·¿m‘”_£t
.
ıp


10 .
ıp


11 
	g»gi¡”_pŞl
.
ıp


12 
	g»gi¡”_»que¡
.
ıp


13 
	g»gi¡”s_m­
.
ıp


14 
	g»que¡
.
ıp


15 
	gcscİe
.
fes


16 
	gblock
.
h


17 
	gblock_»que¡
.
h


18 
	gblock_»que¡_machše
.
h


19 
	gblocks_m­
.
h


20 
	gÿrd_sÿÂ”
.
h


21 
	gcommuniÿtÜ
.
h


22 
	gçuÉs_m­
.
h


23 
	gglob®_¡©e_machše
.
h


24 
	g·¿m‘”_£t
.
h


25 .
h


26 
	g»gi¡”_pŞl
.
h


27 
	g»gi¡”_»que¡
.
h


28 
	g»gi¡”s_m­
.
h


29 
	g»que¡
.
	gh


	@faults_map.cpp

1 
	~"mod–/çuÉs_m­.h
"

3 
	~<QSŒšgLi¡
>

4 
	~<QFe
>

5 
	~<QTextSŒ—m
>

7 
	gFauÉsM­
::
	$FauÉsM­
(è: 
	$m_çuÉsM­
()

8 {
	}
}

10 
FauÉsM­
::~
	$FauÉsM­
()

11 {
	}
}

13 
boŞ
 
FauÉsM­
::
	$lßdFromFe
(
QSŒšg
 
f•©h
)

15 
QFe
 
	`fe
(
f•©h
);

16 ià(!
fe
.
	`İ’
(
QIODeviû
::
R—dOÆy
))

17  
çl£
;

19 
QTextSŒ—m
 
	`¡»am
(&
fe
);

21 !
¡»am
.
	`©End
())

24 
QSŒšg
 
lše
 = 
¡»am
.
	`»adLše
();

26 ià(
lše
.
	`isEm±y
()) ;

27 ià(
lše
.
	`¡¬tsW™h
("//") ||†ine.startsWith("#")) ;

29 
QSŒšgLi¡
 
f›lds
 = 
lše
.
	`¥l™
(",");

30 ià(
f›lds
.
	`couÁ
() == 2)

32 
ušt8_t
 
key
 = 
f›lds
[0].
	`toIÁ
(
NULL
, 0);

33 
m_çuÉsM­
.
	`š£¹
(
key
, 
f›lds
[1]);

37  
çl£
;

41  
Œue
;

42 
	}
}

44 
QSŒšg
 
	gFauÉsM­
::
	$g‘
(
ušt8_t
 
çuÉCode
)

46 
QM­
<
ušt8_t
, 
QSŒšg
>::
cÚ¡_™”©Ü
 
™
 = 
m_çuÉsM­
.
	`fšd
(
çuÉCode
);

47 ià(
™
 =ğ
m_çuÉsM­
.
	`’d
())  "";

48  
™
.
	`v®ue
();

49 
	}
}

	@faults_map.h

1 #iâdeà
FAULTSMAP_H


2 
	#FAULTSMAP_H


	)

4 
	~<QSŒšg
>

5 
	~<QM­
>

7 
	sFauÉsM­


9 
	mpublic
:

10 
FauÉsM­
();

11 ~
FauÉsM­
();

13 
boŞ
 
lßdFromFe
(
QSŒšg
 
f•©h
);

14 
QSŒšg
 
g‘
(
ušt8_t
 
çuÉCode
);

16 
	m´iv©e
:

17 
QM­
<
ušt8_t
, 
	mQSŒšg
> 
	mm_çuÉsM­
;

	@global_state_machine.cpp

1 
	~"mod–/glob®_¡©e_machše.h
"

2 
	~"d©a/d©a.h
"

4 
	gGlob®S‹Machše
::
	$Glob®S‹Machše
(
Regi¡”
* 
¡©eMachšeRegi¡”
, Regi¡”* 
£qu’ûrRegi¡”
, Regi¡”* 
commªdRegi¡”
, 
QObjeù
 *
·»Á
) :

5 
	`QObjeù
(
·»Á
), 
	`m_¡©eMachšeRegi¡”
(
¡©eMachšeRegi¡”
), 
	`m_£qu’ûrRegi¡”
(
£qu’ûrRegi¡”
), 
	`m_commªdRegi¡”
(
commªdRegi¡”
), 
	`m_¡©eMachšePŞËr
(
NULL
), 
	`m_£qu’ûrPŞËr
(NULL), 
	`m_¡©e
(
GLOBAL_STATE_INVALID
), 
	$m_£qu’ûrS‹
(
SEQ_STATE_IDLE
)

7 
	`cÚÃù
(
¡©eMachšeRegi¡”
, 
	`SIGNAL
(
	`ÚChªge
()), 
this
, 
	`SLOT
(
	`ÚS‹MachšeRegi¡”Chªge
()));

8 
	`cÚÃù
(
£qu’ûrRegi¡”
, 
	`SIGNAL
(
	`ÚChªge
()), 
this
, 
	`SLOT
(
	`ÚSequ’ûrS‹Regi¡”Chªge
()));

10 
	`cÚÃù
(
¡©eMachšeRegi¡”
, 
	`SIGNAL
(
	`ÚE¼Ü
(
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(onError(request_error_t)));

11 
	`cÚÃù
(
£qu’ûrRegi¡”
, 
	`SIGNAL
(
	`ÚE¼Ü
(
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(onError(request_error_t)));

12 
	`cÚÃù
(
commªdRegi¡”
, 
	`SIGNAL
(
	`ÚE¼Ü
(
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(onError(request_error_t)));

14 
m_¡©eMachšePŞËr
 = 
¡©eMachšeRegi¡”
->
	`g‘PŞËr
(
this
);

15 
m_£qu’ûrPŞËr
 = 
£qu’ûrRegi¡”
->
	`g‘PŞËr
(
this
);

17 
this
->
	`mÚ™Ü
();

18 
	}
}

20 
	gGlob®S‹Machše
::
	$ÚE¼Ü
(
»que¡_”rÜ_t
)

22 
this
->
m_¡©e
 = 
GLOBAL_STATE_INVALID
;

23 
em™
 
	`ÚE¼Ü
();

24 
	}
}

26 
	gGlob®S‹Machše
::
	$mÚ™Ü
(
boŞ
 
’abË
)

28 
this
->
m_¡©eMachšePŞËr
->
	`’abËPŞl
(
’abË
);

29 
this
->
m_£qu’ûrPŞËr
->
	`’abËPŞl
(
’abË
);

30 
	}
}

32 
	gGlob®S‹Machše
::
	$ÚS‹MachšeRegi¡”Chªge
()

34 
glob®_¡©e_t
 
¡©e
 = (glob®_¡©e_tè
m_¡©eMachšeRegi¡”
->
	`uštV®
();

35 
this
->
m_¡©e
 = 
¡©e
;

36 
em™
 
	`aá”S‹Chªge
();

37 
	}
}

39 
	gGlob®S‹Machše
::
	$ÚSequ’ûrS‹Regi¡”Chªge
()

41 
£qu’ûr_¡©e_t
 
¡©e
 = (£qu’ûr_¡©e_tè
m_£qu’ûrRegi¡”
->
	`uštV®
();

42 
this
->
m_£qu’ûrS‹
 = 
¡©e
;

43 
em™
 
	`aá”S‹Chªge
();

44 
	}
}

46 
glob®_¡©e_t
 
	gGlob®S‹Machše
::
	$cu¼’tS‹
()

48  
this
->
m_¡©e
;

49 
	}
}

51 
£qu’ûr_¡©e_t
 
	gGlob®S‹Machše
::
	$cu¼’tSequ’ûrS‹
()

53  
this
->
m_£qu’ûrS‹
;

54 
	}
}

56 
	gGlob®S‹Machše
::
	$£tS‹
(
glob®_¡©e_t
 
¡©e
)

58 
¡©e
)

60 
GLOBAL_STATE_OFF
:

61 
this
->
	`£ndCommªd
(
COMMAND_OFF
);

63 
GLOBAL_STATE_STANDBY
:

64 
this
->
	`£ndCommªd
(
COMMAND_STANDBY
);

66 
GLOBAL_STATE_DC
:

67 
this
->
	`£ndCommªd
(
COMMAND_DC
);

69 
GLOBAL_STATE_WAVEFORM
:

70 
this
->
	`£ndCommªd
(
COMMAND_WAVEFORM
);

73 
	`Q_ASSERT
(0);

75 
	}
}

77 
	gGlob®S‹Machše
::
	$»£tIÁ”locks
()

79 
this
->
	`£ndCommªd
(
COMMAND_RESET
);

80 
	}
}

82 
	gGlob®S‹Machše
::
	$£ndCommªd
(
commªd_t
 
commªd
)

84 
m_commªdRegi¡”
->
	`wr™e
((
ušt32_t
è
commªd
);

85 
	}
}

	@global_state_machine.h

1 #iâdeà
GLOBAL_STATE_MACHINE_H


2 
	#GLOBAL_STATE_MACHINE_H


	)

4 
	~<QObjeù
>

5 
	~"mod–/»gi¡”.h
"

6 
	~"d©a/d©a.h
"

8 şas 
	cGlob®S‹Machše
 : 
public
 
QObjeù


10 
Q_OBJECT


11 
public
:

12 
ex¶ic™
 
Glob®S‹Machše
(
Regi¡”
* 
¡©eMachšeRegi¡”
, Regi¡”* 
£qu’ûrRegi¡”
, Regi¡”* 
commªdRegi¡”
, 
QObjeù
 *
·»Á
 = 0);

13 
mÚ™Ü
(
boŞ
 
’abË
 = 
Œue
);

14 
glob®_¡©e_t
 
cu¼’tS‹
();

15 
£qu’ûr_¡©e_t
 
cu¼’tSequ’ûrS‹
();

16 
£ndCommªd
(
commªd_t
 
commªd
);

18 
	msigÇls
:

19 
aá”S‹Chªge
();

20 
ÚE¼Ü
();

22 
public
 
	m¦Ùs
:

23 
£tS‹
(
glob®_¡©e_t
 
¡©e
);

24 
»£tIÁ”locks
();

26 
´iv©e
 
	m¦Ùs
:

27 
ÚS‹MachšeRegi¡”Chªge
();

28 
ÚSequ’ûrS‹Regi¡”Chªge
();

29 
ÚE¼Ü
(
»que¡_”rÜ_t
 
”rÜCode
);

31 
	m´iv©e
:

32 
Regi¡”
* 
m_¡©eMachšeRegi¡”
;

33 
Regi¡”
* 
	mm_£qu’ûrRegi¡”
;

34 
Regi¡”
* 
	mm_commªdRegi¡”
;

35 
Regi¡”PŞl
* 
	mm_¡©eMachšePŞËr
;

36 
Regi¡”PŞl
* 
	mm_£qu’ûrPŞËr
;

38 
glob®_¡©e_t
 
	mm_¡©e
;

39 
£qu’ûr_¡©e_t
 
	mm_£qu’ûrS‹
;

	@parameter_set.cpp

1 
	~"mod–/·¿m‘”_£t.h
"

2 
	~<QFe
>

4 
	gP¬am‘”
::
	$P¬am‘”
() :

5 
	`m_Çme
(""), 
	`m_add»ss
(0), 
	`m_ty³
(
PARAMETER_TYPE_INTEGRAL
), 
	`m_hex
(
çl£
), 
	$m_ušt
(0)

6 {
	}
}

8 
	gP¬am‘”
::
	$P¬am‘”
(
QSŒšg
 
Çme
, 
ušt16_t
 
add»ss
, 
P¬am‘”Ty³
 
ty³
, 
boŞ
 
isHex
) :

9 
	`m_Çme
(
Çme
), 
	`m_add»ss
(
add»ss
), 
	`m_ty³
(
ty³
), 
	`m_hex
(
isHex
), 
	$m_ušt
(0)

10 {
	}
}

12 
	gP¬am‘”Defš™iÚs
::
	$P¬am‘”Defš™iÚs
(è: 
	$·¿m‘”s
()

14 
	}
}

16 
boŞ
 
P¬am‘”Defš™iÚs
::
	$lßdFromFe
(
QSŒšg
 
defš™iÚsFe
)

18 
QFe
 
	`fe
(
defš™iÚsFe
);

19 ià(!
fe
.
	`İ’
(
QIODeviû
::
R—dOÆy
))

20  
çl£
;

22 
QTextSŒ—m
 
	`¡»am
(&
fe
);

24 !
¡»am
.
	`©End
())

27 
QSŒšg
 
lše
 = 
¡»am
.
	`»adLše
();

29 ià(
lše
.
	`isEm±y
()) ;

30 ià(
lše
.
	`¡¬tsW™h
("//") ||†ine.startsWith("#")) ;

32 
QSŒšgLi¡
 
f›lds
 = 
lše
.
	`¥l™
(",");

33 ià(
f›lds
.
	`couÁ
() == 3)

35 
P¬am‘”
 
	`·¿m‘”
(

36  
f›lds
.
	`©
(1),

37  
f›lds
.
	`©
(0).
	`toUIÁ
(0, 16),

38  
f›lds
.
	`©
(2è=ğ"št" || f›lds.©(2è=ğ"hex" ? 
PARAMETER_TYPE_INTEGRAL
 : 
PARAMETER_TYPE_FLOATING
,

39  
f›lds
.
	`©
(2) == "hex"

42 
this
->
·¿m‘”s
.
	`­³nd
(
·¿m‘”
);

46  
çl£
;

50  
Œue
;

51 
	}
}

53 
	gP¬am‘”S‘
::
	$P¬am‘”S‘
(
P¬am‘”Defš™iÚs
 *
defš™iÚs
, 
QObjeù
 *
·»Á
è: 
	`QObjeù
Õ¬’t), 
	$·¿m‘”s
()

55 
QVeùÜ
<
P¬am‘”
>::
cÚ¡_™”©Ü
 
™
;

56 
™
 = 
defš™iÚs
->
·¿m‘”s
.
	`begš
(); iˆ< defš™iÚs->·¿m‘”s.
	`’d
(); it++)

58 
P¬am‘”
 *
·¿m‘”
 = 
Ãw
 
	`P¬am‘”
(
™
->
m_Çme
, it->
m_add»ss
, it->
m_ty³
, it->
m_hex
);

59 
·¿m‘”s
[
·¿m‘”
->
m_Çme
] =…arameter;

61 
	}
}

63 
boŞ
 
	gP¬am‘”S‘
::
	$lßdFromBlockA¼ay
(cÚ¡ 
QBy‹A¼ay
 &
d©a
)

65 
QM­
<
QSŒšg
, 
P¬am‘”
 *>::
™”©Ü
 
™
;

66 
™
 = 
·¿m‘”s
.
	`begš
(); iˆ!ğ·¿m‘”s.
	`’d
(); it++)

68 
ušt16_t
 
add»ss
 = 
™
.
	`v®ue
()->
m_add»ss
;

69 
	`Q_ASSERT
(
add»ss
 + (
ušt32_t
è- 1 < (
ušt16_t
è
d©a
.
	`Ëngth
());

71 
ušt32_t
 
v®ue
;

72 
	`memıy
(&
v®ue
, 
d©a
.
	`d©a
(è+ 
add»ss
 * 4, (
ušt32_t
));

73 
™
.
	`v®ue
()->
m_ušt
 = 
v®ue
;

76 
em™
 
	`ÚS‘Lßded
();

77  
Œue
;

78 
	}
}

80 
boŞ
 
	gP¬am‘”S‘
::
	$lßdFromFe
(
QSŒšg
 
f•©h
)

82 
QFe
 
	`fe
(
f•©h
);

83 ià(!
fe
.
	`İ’
(
QIODeviû
::
R—dOÆy
)è 
çl£
;

85 
QTextSŒ—m
 
	`¡»am
(&
fe
);

87 !
¡»am
.
	`©End
())

90 
QSŒšg
 
lše
 = 
¡»am
.
	`»adLše
();

92 ià(
lše
.
	`isEm±y
()) ;

93 ià(
lše
.
	`¡¬tsW™h
("//") ||†ine.startsWith("#")) ;

95 
QSŒšgLi¡
 
f›lds
 = 
lše
.
	`¥l™
("=");

96 ià(
f›lds
.
	`couÁ
() == 2)

98 
QSŒšg
 
Çme
 = 
f›lds
.
	`©
(0).
	`Œimmed
();

99 ià(!
this
->
·¿m‘”s
.
	`cÚšs
(
Çme
)è 
çl£
;

100 
P¬am‘”
 *
·¿m‘”
 = 
this
->
·¿m‘”s
[
Çme
];

102 ià(
·¿m‘”
->
m_ty³
 =ğ
PARAMETER_TYPE_INTEGRAL
 && !·¿m‘”->
m_hex
)

104 
·¿m‘”
->
m_št
 = 
f›lds
.
	`©
(1).
	`Œimmed
().
	`toLÚg
();

106 ià(
·¿m‘”
->
m_ty³
 =ğ
PARAMETER_TYPE_INTEGRAL
 &&…¬am‘”->
m_hex
)

108 
boŞ
 
ok
;

109 
·¿m‘”
->
m_št
 = 
f›lds
.
	`©
(1).
	`Œimmed
().
	`toLÚg
(&
ok
, 16);

111 ià(
·¿m‘”
->
m_ty³
 =ğ
PARAMETER_TYPE_FLOATING
)

113 
·¿m‘”
->
m_æßt
 = 
f›lds
.
	`©
(1).
	`Œimmed
().
	`toFlßt
();

118  
çl£
;

122  
Œue
;

123 
	}
}

125 
	gP¬am‘”S‘
::
	$§veToFe
(
QSŒšg
 
f•©h
)

127 
QFe
 
	`fe
(
f•©h
);

128 ià(!
fe
.
	`İ’
(
QIODeviû
::
Wr™eOÆy
)) ;

130 
QTextSŒ—m
 
	`¡»am
(&
fe
);

132 
QM­
<
QSŒšg
, 
P¬am‘”
 *>::
cÚ¡_™”©Ü
 
™
;

133 
™
 = 
·¿m‘”s
.
	`cÚ¡Begš
(); iˆ!ğ·¿m‘”s.
	`cÚ¡End
(); it++)

135 
P¬am‘”
 *
·¿m‘”
 = 
™
.
	`v®ue
();

136 
¡»am
 << 
·¿m‘”
->
m_Çme
 << " = ";

137 ià(
·¿m‘”
->
m_ty³
 =ğ
PARAMETER_TYPE_INTEGRAL
 &&…¬am‘”->
m_hex
)

139 
¡»am
 << "0x" << 
QSŒšg
::
	`numb”
(
·¿m‘”
->
m_št
, 16);

141 ià(
·¿m‘”
->
m_ty³
 =ğ
PARAMETER_TYPE_INTEGRAL
 && !·¿m‘”->
m_hex
)

143 
¡»am
 << 
QSŒšg
::
	`numb”
(
·¿m‘”
->
m_št
);

145 ià(
·¿m‘”
->
m_ty³
 =ğ
PARAMETER_TYPE_FLOATING
)

147 
¡»am
 << 
QSŒšg
::
	`numb”
(
·¿m‘”
->
m_æßt
);

149 
¡»am
 << 
’dl
;

151 
	}
}

153 
	gP¬am‘”S‘
::
	$§veToBlock
(
Block
 *
block
)

155 
QBy‹A¼ay
 
	`d©a
(
block
->
	`numb”OfRegi¡”s
(è* (
ušt32_t
), '\0');

157 
QM­
<
QSŒšg
, 
P¬am‘”
 *>::
cÚ¡_™”©Ü
 
™
;

158 
™
 = 
·¿m‘”s
.
	`begš
(); iˆ!ğ·¿m‘”s.
	`’d
(); it++)

160 
ušt16_t
 
add»ss
 = 
™
.
	`v®ue
()->
m_add»ss
;

161 
	`Q_ASSERT
(
add»ss
 + (
ušt32_t
è- 1 < (
ušt16_t
è
d©a
.
	`Ëngth
());

162 
	`memıy
(
d©a
.
	`d©a
(è+ 
add»ss
 * 4, &
™
.
	`v®ue
()->
m_ušt
, (
ušt32_t
));

165 
block
->
	`wr™e
(
d©a
);

166 
	}
}

168 
	gP¬am‘”S‘
::~
	$P¬am‘”S‘
()

170 
QM­
<
QSŒšg
, 
P¬am‘”
 *>::
™”©Ü
 
™
;

171 
™
 = 
·¿m‘”s
.
	`begš
(); iˆ!ğ·¿m‘”s.
	`’d
(); it++)

173 
d–‘e
 
™
.
	`v®ue
();

176 
·¿m‘”s
.
	`ş—r
();

177 
	}
}

	@parameter_set.h

1 #iâdeà
PARAMETERSET_H


2 
	#PARAMETERSET_H


	)

4 
	~<QObjeù
>

5 
	~<QSŒšg
>

6 
	~<QSŒšgLi¡
>

7 
	~<QVeùÜ
>

8 
	~<QBy‹A¼ay
>

9 
	~<QM­
>

11 
	~"mod–/block.h
"

13 
	eP¬am‘”Ty³


15 
	mPARAMETER_TYPE_INTEGRAL
,

16 
	mPARAMETER_TYPE_FLOATING


19 
	sP¬am‘”


21 
ex¶ic™
 
P¬am‘”
();

22 
ex¶ic™
 
P¬am‘”
(
QSŒšg
 
Çme
, 
ušt16_t
 
add»ss
, 
P¬am‘”Ty³
 
ty³
, 
boŞ
 
isHex
);

24 
QSŒšg
 
	mm_Çme
;

25 
ušt16_t
 
	mm_add»ss
;

26 
P¬am‘”Ty³
 
	mm_ty³
;

27 
boŞ
 
	mm_hex
;

31 
št32_t
 
	mm_št
;

32 
ušt32_t
 
	mm_ušt
;

33 
	mm_æßt
;

37 
	sP¬am‘”Defš™iÚs


39 
ex¶ic™
 
P¬am‘”Defš™iÚs
();

40 
boŞ
 
lßdFromFe
(
QSŒšg
 
defš™iÚsFe
);

41 
	mQVeùÜ
<
	mP¬am‘”
> 
	m·¿m‘”s
;

44 şas 
	cP¬am‘”S‘
 : 
public
 
QObjeù


46 
Q_OBJECT


47 
public
:

48 
ex¶ic™
 
P¬am‘”S‘
(
P¬am‘”Defš™iÚs
 *
defš™iÚs
, 
QObjeù
 *
·»Á
 = 0);

49 ~
P¬am‘”S‘
();

51 
	mQM­
<
	mQSŒšg
, 
	mP¬am‘”
 *> 
	m·¿m‘”s
;

53 
	msigÇls
:

54 
ÚS‘Lßded
();

56 
public
 
	m¦Ùs
:

57 
boŞ
 
lßdFromFe
(
QSŒšg
 
f•©h
);

58 
boŞ
 
lßdFromBlockA¼ay
(cÚ¡ 
QBy‹A¼ay
 &
d©a
);

59 
§veToFe
(
QSŒšg
 
f•©h
);

60 
§veToBlock
(
Block
 *
block
);

62 
	m´iv©e
:

	@register.cpp

1 
	~"mod–/»gi¡”.h
"

2 
	~"mod–/communiÿtÜ.h
"

4 
	~<QSŒšg
>

6 
	gRegi¡”
::
	$Regi¡”
(
CommuniÿtÜ
* 
communiÿtÜ
, 
ušt16_t
 
add»ss
, 
QSŒšg
 
Çme
, 
Regi¡”Ty³
 
ty³
, 
boŞ
 
showAsHex
, 
QObjeù
 *
·»Á
) :

7 
	`QObjeù
(
·»Á
), 
	`showAsHex
(
showAsHex
), 
	`m_add»ss
(
add»ss
), 
	`m_Çme
(
Çme
), 
	`m_ty³
(
ty³
), 
	`m_v®id
(
çl£
), 
	`m_ušt
(0), 
	$m_communiÿtÜ
(
communiÿtÜ
)

9 
	}
}

11 
Regi¡”PŞl
* 
	gRegi¡”
::
	$g‘PŞËr
(
pŞlIÁ”v®_ms
, 
QObjeù
 *
·»Á
)

13  
Ãw
 
	`Regi¡”PŞl
(
this
, 
pŞlIÁ”v®_ms
, 
·»Á
 =ğ
NULL
 ?his :…arent);

14 
	}
}

16 
Regi¡”PŞl
* 
	gRegi¡”
::
	$g‘PŞËr
(
QObjeù
 *
·»Á
)

18  
Ãw
 
	`Regi¡”PŞl
(
this
, 
DEFAULT_POLL_INTERVAL
, 
·»Á
 =ğ
NULL
 ?his :…arent);

19 
	}
}

21 
	gRegi¡”
::
	$»ad
()

23 
Regi¡”Reque¡
* 
»que¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_R—d
, 
m_add»ss
, 
this
);

24 
	`cÚÃù
(
»que¡
, 
	`SIGNAL
(
	`ÚR•ly
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(
	`ÚR—dR•ly
(RegisterRequest*)));

25 
	`cÚÃù
(
»que¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*, 
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`ÚR—dE¼Ü
(RegisterRequest*,„equest_error_t)));

26 
	`cÚÃù
(
»que¡
, 
	`SIGNAL
(
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*)), 
this
, 
	`SLOT
(onHandlingDone(RegisterRequest*)));

28 
m_communiÿtÜ
->
	`queueReque¡
(
»que¡
);

29 
	}
}

31 
	gRegi¡”
::
	$ÚR—dR•ly
(
Regi¡”Reque¡
* 
»que¡
)

33 
boŞ
 
Şd_v®id
 = 
this
->
m_v®id
;

34 
ušt32_t
 
Şd_v®ue
 = 
this
->
m_ušt
;

36 
this
->
m_ušt
 = 
»que¡
->
	`uštV®
();

37 
this
->
m_v®id
 = 
Œue
;

39 
em™
 
	`ÚR—dR•ly
();

40 ià(!
Şd_v®id
 || (
Şd_v®ue
 !ğ
this
->
m_ušt
)è
em™
 
	`ÚChªge
();

41 
	}
}

43 
	gRegi¡”
::
	$ÚHªdlšgDÚe
(
Regi¡”Reque¡
* 
»que¡
)

45 
»que¡
->
	`d–‘eL©”
();

46 
	}
}

48 
	gRegi¡”
::
	$ÚR—dE¼Ü
(
Regi¡”Reque¡
*, 
»que¡_”rÜ_t
 
”rÜCode
)

50 
boŞ
 
Şd_v®id
 = 
this
->
m_v®id
;

51 
this
->
m_v®id
 = 
çl£
;

53 
em™
 
	`ÚR—dR•ly
();

54 
em™
 
	`ÚR—dE¼Ü
(
”rÜCode
);

55 
em™
 
	`ÚE¼Ü
(
”rÜCode
);

57 ià(
Şd_v®id
è
em™
 
	`ÚChªge
();

58 
	}
}

60 
	gRegi¡”
::
	$ÚWr™eE¼Ü
(
Regi¡”Reque¡
*, 
»que¡_”rÜ_t
 
”rÜCode
)

62 
em™
 
	`ÚWr™eE¼Ü
(
”rÜCode
);

63 
em™
 
	`ÚE¼Ü
(
”rÜCode
);

64 
	}
}

68 
	gRegi¡”
::
	$wr™e
(
št32_t
 
v®ue
)

70 
Regi¡”Reque¡
* 
»que¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_Wr™e
, 
m_add»ss
, 
this
);

71 
»que¡
->
	`£tD©a
(
v®ue
);

72 
	`cÚÃù
(
»que¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*, 
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`ÚWr™eE¼Ü
(RegisterRequest*,„equest_error_t)));

73 
m_communiÿtÜ
->
	`queueReque¡
(
»que¡
);

74 
	}
}

76 
	gRegi¡”
::
	$wr™e
(
ušt32_t
 
v®ue
)

78 
Regi¡”Reque¡
* 
»que¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_Wr™e
, 
m_add»ss
, 
this
);

79 
»que¡
->
	`£tD©a
(
v®ue
);

80 
	`cÚÃù
(
»que¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*, 
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`ÚWr™eE¼Ü
(RegisterRequest*,„equest_error_t)));

81 
m_communiÿtÜ
->
	`queueReque¡
(
»que¡
);

82 
	}
}

84 
	gRegi¡”
::
	$wr™e
(
v®ue
)

86 
Regi¡”Reque¡
* 
»que¡
 = 
Ãw
 
	`Regi¡”Reque¡
(
Regi¡”Reque¡Ty³_Wr™e
, 
m_add»ss
, 
this
);

87 
»que¡
->
	`£tD©a
(
v®ue
);

88 
	`cÚÃù
(
»que¡
, 
	`SIGNAL
(
	`ÚE¼Ü
(
Regi¡”Reque¡
*, 
»que¡_”rÜ_t
)), 
this
, 
	`SLOT
(
	`ÚWr™eE¼Ü
(RegisterRequest*,„equest_error_t)));

89 
m_communiÿtÜ
->
	`queueReque¡
(
»que¡
);

90 
	}
}

92 
QSŒšg
 
	gRegi¡”
::
	$toSŒšg
() const

94 ià(
m_v®id
)

96 ià(
m_ty³
 =ğ
REGISTER_TYPE_INTEGRAL
)

97  (
showAsHex
 ? "0x" : ""è+ 
QSŒšg
::
	`numb”
(
m_št
, showAsHex ? 16 : 10);

99  
	`QSŒšg
("%1").
	`¬g
(
m_æßt
, 4, 'f', 4);

103 
	}
}

	@register.h

1 #iâdeà
REGISTER_H


2 
	#REGISTER_H


	)

4 
	~<QObjeù
>

6 
	~"mod–/communiÿtÜ.h
"

7 
	~"mod–/»que¡.h
"

8 
	~"mod–/»gi¡”_pŞl.h
"

9 
	~"d©a/d©a.h
"

11 
şass
 
	gRegi¡”PŞl
;

13 
	eRegi¡”Ty³


15 
	mREGISTER_TYPE_INTEGRAL
,

16 
	mREGISTER_TYPE_FLOATING


19 şas 
	cRegi¡”
 : 
public
 
QObjeù


21 
Q_OBJECT


23 
public
:

24 
ex¶ic™
 
Regi¡”
(
CommuniÿtÜ
* 
m_communiÿtÜ
, 
ušt16_t
 
add»ss
, 
QSŒšg
 
Çme
, 
Regi¡”Ty³
 
ty³
, 
boŞ
 
showAsHex
 = 
çl£
, 
QObjeù
 *
·»Á
 = 0);

26 
Regi¡”PŞl
* 
g‘PŞËr
(
pŞlIÁ”v®_ms
, 
QObjeù
 *
·»Á
 = 
NULL
);

27 
Regi¡”PŞl
* 
g‘PŞËr
(
QObjeù
 *
·»Á
 = 
NULL
);

29 
ušt16_t
 
	$add»ss
(ècÚ¡ {  
this
->
m_add»ss
; }

30 
QSŒšg
 
	$Çme
(ècÚ¡ {  
this
->
m_Çme
; 
	}
}

31 
Regi¡”Ty³
 
	$ty³
(ècÚ¡ {  
this
->
m_ty³
; 
	}
}

32 
št32_t
 
	$štV®
(ècÚ¡ {  
this
->
m_št
; 
	}
}

33 
ušt32_t
 
	$uštV®
(ècÚ¡ {  
this
->
m_ušt
; 
	}
}

34 
	$æßtV®
(ècÚ¡ {  
this
->
m_æßt
; 
	}
}

35 
boŞ
 
	$v®id
(ècÚ¡ {  
this
->
m_v®id
; 
	}
}

36 
CommuniÿtÜ
 *
	$communiÿtÜ
(è{  
this
->
m_communiÿtÜ
; 
	}
}

38 
QSŒšg
 
	$toSŒšg
() const;

40 
boŞ
 
showAsHex
;

43 
sigÇls
:

44 
	`ÚChªge
();

45 
	`ÚR—dR•ly
();

46 
	`ÚR—dE¼Ü
(
»que¡_”rÜ_t
 
”rÜCode
);

47 
	`ÚWr™eE¼Ü
(
»que¡_”rÜ_t
 
”rÜCode
);

48 
	`ÚE¼Ü
(
»que¡_”rÜ_t
 
”rÜCode
);

50 
public
 
¦Ùs
:

51 
	`»ad
();

53 
	`wr™e
(
št32_t
 
v®ue
);

54 
	`wr™e
(
ušt32_t
 
v®ue
);

55 
	`wr™e
(
v®ue
);

57 
´iv©e
 
¦Ùs
:

58 
	`ÚR—dR•ly
(
Regi¡”Reque¡
*);

59 
	`ÚR—dE¼Ü
(
Regi¡”Reque¡
*, 
»que¡_”rÜ_t
);

60 
	`ÚWr™eE¼Ü
(
Regi¡”Reque¡
*, 
»que¡_”rÜ_t
);

61 
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
*);

63 
´iv©e
:

64 
ušt16_t
 
m_add»ss
;

65 
QSŒšg
 
m_Çme
;

66 
Regi¡”Ty³
 
m_ty³
;

68 
boŞ
 
m_v®id
;

72 
št32_t
 
m_št
;

73 
ušt32_t
 
m_ušt
;

74 
m_æßt
;

75 
	}
};

77 
CommuniÿtÜ
* 
	gm_communiÿtÜ
;

	@register_poll.cpp

1 
	~"mod–/»gi¡”_pŞl.h
"

3 
	gRegi¡”PŞl
::
	$Regi¡”PŞl
(
Regi¡”
* 
»gi¡”_
, 
pŞlIÁ”v®_ms
, 
QObjeù
 *
·»Á
) :

4 
	`QObjeù
(
·»Á
),

5 
	`»gi¡”_
(
»gi¡”_
),

6 
	`pŞlTim”
(
NULL
),

7 
	`pŞlEÇbËd
(
çl£
),

8 
	$pŞlIÁ”v®
(
pŞlIÁ”v®_ms
)

10 
	`cÚÃù
(
»gi¡”_
, 
	`SIGNAL
(
	`ÚR—dR•ly
()), 
this
, 
	`SLOT
(
	`»adR•ly
()));

11 
	}
}

13 
	gRegi¡”PŞl
::
	$’abËPŞl
(
boŞ
 
’abË
)

15 ià(
’abË
)

17 ià(!
pŞlTim”
)

19 
pŞlTim”
 = 
Ãw
 
	`QTim”
(
this
);

20 
pŞlTim”
->
	`£tSšgËShÙ
(
Œue
);

21 
	`cÚÃù
(
pŞlTim”
, 
	`SIGNAL
(
	`timeout
()), 
this
->
»gi¡”_
, 
	`SLOT
(
	`»ad
()));

24 
pŞlTim”
->
	`¡¬t
(
pŞlIÁ”v®
);

28 ià(
pŞlTim”
èpŞlTim”->
	`¡İ
();

31 
pŞlEÇbËd
 = 
’abË
;

32 
	}
}

34 
boŞ
 
	gRegi¡”PŞl
::
	$isPŞlEÇbËd
() const

36  
this
->
pŞlEÇbËd
;

37 
	}
}

39 
	gRegi¡”PŞl
::
	$»¡¬tTim”
()

41 ià(
pŞlEÇbËd
è
pŞlTim”
->
	`¡¬t
(
pŞlIÁ”v®
);

42 
	}
}

44 
	gRegi¡”PŞl
::
	$»adR•ly
()

46 
this
->
	`»¡¬tTim”
();

47 
	}
}

	@register_poll.h

1 #iâdeà
REGISTER_POLL_H


2 
	#REGISTER_POLL_H


	)

4 
	~<QObjeù
>

5 
	~<QTim”
>

7 
	~"mod–/»gi¡”.h
"

8 
şass
 
	gRegi¡”
;

10 şas 
	cRegi¡”PŞl
 : 
public
 
QObjeù


12 
Q_OBJECT


13 
public
:

14 
ex¶ic™
 
Regi¡”PŞl
(
Regi¡”
* 
»gi¡”_
, 
pŞlIÁ”v®_ms
, 
QObjeù
 *
·»Á
 = 0);

15 
’abËPŞl
(
boŞ
);

16 
boŞ
 
	$isPŞlEÇbËd
() const;

18 
´iv©e
 
¦Ùs
:

19 
	`»adR•ly
();

21 
´iv©e
:

22 
	`»¡¬tTim”
();

24 
Regi¡”
* 
»gi¡”_
;

25 
QTim”
* 
pŞlTim”
;

26 
boŞ
 
pŞlEÇbËd
;

27 
pŞlIÁ”v®
;

	@register_request.cpp

1 
	~"mod–/»gi¡”_»que¡.h
"

3 
	gRegi¡”Reque¡
::
	$Regi¡”Reque¡
(
Regi¡”Reque¡Ty³
 
»que¡Ty³
, 
ušt16_t
 
add»ss
, 
QObjeù
 *
·»Á
) :

4 
	`QObjeù
(
·»Á
), 
	`g‘NextReque¡
(
NULL
), 
	`m_u£rArg
(NULL), 
	`m_»que¡Ty³
(
»que¡Ty³
), 
	`m_add»ss
(
add»ss
), 
	$m_ušt
(0)

6 
	}
}

8 
	gRegi¡”Reque¡
::
	$£tD©a
(
ušt32_t
 
v®ue
)

10 
this
->
m_ušt
 = 
v®ue
;

11 
	}
}

13 
	gRegi¡”Reque¡
::
	$£tD©a
(
št32_t
 
v®ue
)

15 
this
->
m_št
 = 
v®ue
;

16 
	}
}

18 
	gRegi¡”Reque¡
::
	$£tD©a
(
v®ue
)

20 
this
->
m_æßt
 = 
v®ue
;

21 
	}
}

23 
ušt32_t
 
	gRegi¡”Reque¡
::
	$mes§geL’gth
() const

25 cÚ¡ 
ušt32_t
 
STATUS_LENGTH
 = 2;

26 cÚ¡ 
ušt32_t
 
TYPE_LENGTH
 = 2;

27 cÚ¡ 
ušt32_t
 
ADD_LENGTH
 = 2;

28 cÚ¡ 
ušt32_t
 
MSG_LENGTH
 = 4;

29  
STATUS_LENGTH
 + 
TYPE_LENGTH
 + 
ADD_LENGTH
 + 
MSG_LENGTH
;

30 
	}
}

32 
ušt32_t
 
	gRegi¡”Reque¡
::
	$»maššgBy‹s
() const

34  
this
->
	`mes§geL’gth
();

35 
	}
}

37 * 
	gRegi¡”Reque¡
::
	$g‘Mes§ge
() const

39 * 
msg
 = (*è
	`m®loc
(
	`mes§geL’gth
());

40 
	`memıy
(
msg
 + 0, &
STATUS_RAW
, 2);

41 
	`memıy
(
msg
 + 2, &
m_»que¡Ty³
, 2);

42 
ušt16_t
 
add»ss
 = 
m_add»ss
 | 0x4000;

43 
	`memıy
(
msg
 + 4, &
add»ss
, 2);

44 
	`memıy
(
msg
 + 6, &
m_ušt
, 4);

45  
msg
;

46 
	}
}

48 
	gRegi¡”Reque¡
::
	$ÚTimeout
()

50 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_TIMEOUT
);

51 
em™
 
	`ÚHªdlšgDÚe
(
this
);

52 
	}
}

54 
SomeReque¡
 
	gRegi¡”Reque¡
::
	$hªdËRe¥Ú£
(*
»¥Ú£
, 
size_t
 
»¥Ú£L’gth
)

56 ià(
»¥Ú£L’gth
 !ğ
	`»maššgBy‹s
())

58 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_SIZE_MISMATCH
);

62 
ušt16_t
 
add»ss
;

63 
ušt16_t
 
»que¡Ty³
;

64 
ušt32_t
 
d©a
;

66 
	`memıy
(&
»que¡Ty³
, 
»¥Ú£
 + 2, 2);

67 
	`memıy
(&
add»ss
 , 
»¥Ú£
 + 4, 2);

68 
	`memıy
(&
d©a
 , 
»¥Ú£
 + 6, 4);

70 ià((
add»ss
 && 0xFFè!ğ(
m_add»ss
 && 0xFF))

71 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_ADDRESS_MISMATCH
);

72 ià(
»que¡Ty³
 !ğ
m_»que¡Ty³
)

73 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_MISMATCH
);

74 ià(
»que¡Ty³
 =ğ
Regi¡”Reque¡Ty³_Wr™e
 && 
d©a
 !ğ
m_ušt
)

75 
em™
 
	`ÚE¼Ü
(
this
, 
REQUEST_ERROR_WRITE_FAILED
);

78 
m_ušt
 = 
d©a
;

80 ià(
»que¡Ty³
 =ğ
Regi¡”Reque¡Ty³_R—d
)

81 
em™
 
	`ÚR—dDÚe
(
this
);

82 ià(
»que¡Ty³
 =ğ
Regi¡”Reque¡Ty³_Wr™e
)

83 
em™
 
	`ÚWr™eDÚe
(
this
);

85 
em™
 
	`ÚR•ly
(
this
);

89 
SomeReque¡
 
»que¡
;

90 ià(
g‘NextReque¡
 !ğ
NULL
)

91 
»que¡
 = 
	`g‘NextReque¡
(
m_u£rArg
);

93 
»que¡
 = 
	`SomeReque¡
();

95 
em™
 
	`ÚHªdlšgDÚe
(
this
);

96  
»que¡
;

97 
	}
}

99 
	gRegi¡”Reque¡
::
	$ä“Mes§ge
(* 
mes§ge
)

101 
	`ä“
(
mes§ge
);

102 
mes§ge
 = 
NULL
;

103 
	}
}

	@register_request.h

1 #iâdeà
REGISTER_REQUEST_H


2 
	#REGISTER_REQUEST_H


	)

4 
	~<QObjeù
>

5 
	~"mod–/»que¡.h
"

7 
	gSomeReque¡
;

9 
	gRegi¡”Reque¡Ty³
 : 
ušt16_t


11 
Regi¡”Reque¡Ty³_R—d
 = 0x0001,

12 
	gRegi¡”Reque¡Ty³_Wr™e
 = 0x0002,

13 
	gRegi¡”Reque¡Ty³_PŞl
 = 0x0004,

16 şas 
	cRegi¡”Reque¡
 : 
public
 
QObjeù


18 
Q_OBJECT


20 
public
:

21 
ex¶ic™
 
Regi¡”Reque¡
(
Regi¡”Reque¡Ty³
 
»que¡Ty³
, 
ušt16_t
 
add»ss
, 
QObjeù
 *
·»Á
 = 0);

23 
Regi¡”Reque¡Ty³
 
	$»que¡Ty³
(ècÚ¡ {  
this
->
m_»que¡Ty³
; }

24 
ušt16_t
 
	$add»ss
(ècÚ¡ {  
this
->
m_add»ss
; 
	}
}

26 
št32_t
 
	$štV®
(ècÚ¡ {  
this
->
m_št
; 
	}
}

27 
ušt32_t
 
	$uštV®
(ècÚ¡ {  
this
->
m_ušt
; 
	}
}

28 
	$æßtV®
(ècÚ¡ {  
this
->
m_æßt
; 
	}
}

30 
ušt32_t
 
	$mes§geL’gth
() const;

31 
ušt32_t
 
	$»maššgBy‹s
() const;

33 * 
	$g‘Mes§ge
() const;

34 
	`ä“Mes§ge
(* 
mes§ge
);

36 
SomeReque¡
 
	`hªdËRe¥Ú£
(* 
»¥Ú£
, 
size_t
 
»¥Ú£L’gth
);

37 
	$SomeReque¡
 (*
g‘NextReque¡
)(* 
u£rArg
);

38 * 
m_u£rArg
;

40 
sigÇls
:

41 
	`ÚR•ly
(
Regi¡”Reque¡
* 
»que¡
);

42 
	`ÚR—dDÚe
(
Regi¡”Reque¡
* 
»que¡
);

43 
	`ÚWr™eDÚe
(
Regi¡”Reque¡
* 
»que¡
);

44 
	`ÚE¼Ü
(
Regi¡”Reque¡
* 
»que¡
, 
»que¡_”rÜ_t
 
”rÜCode
);

45 
	`ÚHªdlšgDÚe
(
Regi¡”Reque¡
* 
»que¡
);

47 
public
 
¦Ùs
:

48 
	`ÚTimeout
();

50 
	`£tD©a
(
ušt32_t
 
v®ue
);

51 
	`£tD©a
(
št32_t
 
v®ue
);

52 
	`£tD©a
(
v®ue
);

54 
´iv©e
:

55 
Regi¡”Reque¡Ty³
 
m_»que¡Ty³
;

56 
ušt16_t
 
m_add»ss
;

60 
ušt32_t
 
m_ušt
;

61 
št32_t
 
m_št
;

62 
m_æßt
;

63 
m_by‹s
[4];

64 
	}
};

	@registers_map.cpp

1 
	~"mod–/»gi¡”s_m­.h
"

3 
	~<QSŒšgLi¡
>

4 
	~<QFe
>

5 
	~<QTextSŒ—m
>

7 
	gRegi¡”sM­
::
	$Regi¡”sM­
(
CommuniÿtÜ
* 
communiÿtÜ
) :

8 
	$communiÿtÜ
(
communiÿtÜ
)

10 
	}
}

12 
boŞ
 
Regi¡”sM­
::
	$lßdFromFe
(
QSŒšg
 
f•©h
)

14 
QFe
 
	`fe
(
f•©h
);

15 ià(!
fe
.
	`İ’
(
QIODeviû
::
R—dOÆy
))

16  
çl£
;

18 
QTextSŒ—m
 
	`¡»am
(&
fe
);

20 !
¡»am
.
	`©End
())

23 
QSŒšg
 
lše
 = 
¡»am
.
	`»adLše
();

25 ià(
lše
.
	`isEm±y
()) ;

26 ià(
lše
.
	`¡¬tsW™h
("//") ||†ine.startsWith("#")) ;

28 
QSŒšgLi¡
 
f›lds
 = 
lše
.
	`¥l™
(",");

29 ià(
f›lds
.
	`couÁ
() == 3)

31 
Regi¡”
* 
»g
 = 
Ãw
 
	`Regi¡”
(

32 
communiÿtÜ
,

33 
f›lds
.
	`©
(0).
	`toUIÁ
(0, 16),

34 
f›lds
.
	`©
(1),

35 
f›lds
.
	`©
(2è=ğ"št" || f›lds.©(2è=ğ"hex" ? 
REGISTER_TYPE_INTEGRAL
 : 
REGISTER_TYPE_FLOATING
,

36 
f›lds
.
	`©
(2) == "hex"

39 
»gi¡”sByAdd»ss
.
	`š£¹
(
»g
->
	`add»ss
(),„eg);

40 
»gi¡”sByName
.
	`š£¹
(
»g
->
	`Çme
(),„eg);

44  
çl£
;

48  
Œue
;

49 
	}
}

51 
	gRegi¡”sM­
::~
	$Regi¡”sM­
()

53 
QM­
<
ušt16_t
, 
Regi¡”
*>::
™”©Ü
 iterator;

54 
™”©Ü
 = 
»gi¡”sByAdd»ss
.
	`begš
(); i‹¿tÜ !ğ»gi¡”sByAdd»ss.
	`’d
(); iterator++)

56 
d–‘e
 
™”©Ü
.
	`v®ue
();

58 
	}
}

60 
Regi¡”
* 
	gRegi¡”sM­
::
	$g‘
(
QSŒšg
 
Çme
)

62  
»gi¡”sByName
[
Çme
];

63 
	}
}

65 
Regi¡”
* 
	gRegi¡”sM­
::
	$g‘
(
ušt16_t
 
add»ss
)

67  
»gi¡”sByAdd»ss
[
add»ss
];

68 
	}
}

	@registers_map.h

1 #iâdeà
REGISTERSMAP_H


2 
	#REGISTERSMAP_H


	)

4 
	~<QSŒšg
>

5 
	~<QM­
>

7 
	~"mod–/communiÿtÜ.h
"

8 
	~"mod–/»gi¡”.h
"

10 
	sRegi¡”sM­


12 
	mpublic
:

13 
ex¶ic™
 
Regi¡”sM­
(
CommuniÿtÜ
* 
communiÿtÜ
);

14 ~
Regi¡”sM­
();

16 
Regi¡”
* 
g‘
(
QSŒšg
 
Çme
);

17 
Regi¡”
* 
g‘
(
ušt16_t
 
add»ss
);

19 
boŞ
 
lßdFromFe
(
QSŒšg
 
f•©h
);

22 
	mQM­
<
	mušt16_t
, 
	mRegi¡”
*> 
	m»gi¡”sByAdd»ss
;

23 
	mQM­
<
	mQSŒšg
, 
	mRegi¡”
*> 
	m»gi¡”sByName
;

25 
	m´iv©e
:

26 
CommuniÿtÜ
* 
communiÿtÜ
;

	@request.cpp

1 
	~"mod–/»que¡.h
"

3 
	gSomeReque¡
::
	$SomeReque¡
(
Regi¡”Reque¡
 *
»que¡
, 
timeout
)

5 
this
->
m_»que¡Ty³
 = 
SomeReque¡Ty³_Regi¡”
;

6 
this
->
m_timeout
 = 
timeout
;

7 
this
->
»que¡
 =„equest;

8 
	}
}

10 
	gSomeReque¡
::
	$SomeReque¡
(
BlockReque¡
 *
blockReque¡
, 
timeout
)

12 
this
->
m_»que¡Ty³
 = 
SomeReque¡Ty³_Block
;

13 
this
->
m_timeout
 = 
timeout
;

14 
this
->
blockReque¡
 = blockRequest;

15 
	}
}

17 
	gSomeReque¡
::
	$SomeReque¡
()

19 
this
->
m_»que¡Ty³
 = 
SomeReque¡Ty³_NÚe
;

20 
	}
}

22 
Regi¡”Reque¡
* 
	gSomeReque¡
::
	$g‘Regi¡”Reque¡
()

24 
	`Q_ASSERT
(
this
->
m_»que¡Ty³
 =ğ
SomeReque¡Ty³_Regi¡”
);

25  
this
->
»que¡
;

26 
	}
}

28 
BlockReque¡
* 
	gSomeReque¡
::
	$g‘BlockReque¡
()

30 
	`Q_ASSERT
(
this
->
m_»que¡Ty³
 =ğ
SomeReque¡Ty³_Block
);

31  
this
->
blockReque¡
;

32 
	}
}

34 
QSŒšg
 
	gSomeReque¡
::
	$g‘E¼ÜDesc
(
»que¡_”rÜ_t
 
”rÜCode
)

36 ià(
”rÜCode
 >ğ0 &&ƒ¼ÜCod< 
REQUEST_ERROR_MAX
)

37  
”rÜDesc
[
”rÜCode
];

39  
	`QSŒšg
("unknownƒrror");

40 
	}
}

	@request.h

1 #iâdeà
REQUEST_H


2 
	#REQUEST_H


	)

4 
	~<QObjeù
>

6 
	e»que¡_”rÜ_t


8 
	mREQUEST_ERROR_UNKNOWN
,

9 
	mREQUEST_ERROR_ADDRESS_MISMATCH
,

10 
	mREQUEST_ERROR_SIZE_MISMATCH
,

11 
	mREQUEST_ERROR_MISMATCH
,

12 
	mREQUEST_ERROR_WRITE_FAILED
,

13 
	mREQUEST_ERROR_TIMEOUT
,

14 
	mREQUEST_ERROR_MAX
,

17 cÚ¡ 
ušt16_t
 
	gSTATUS_RAW
 = 0x0000;

19 cÚ¡ 
QSŒšg
 
	g”rÜDesc
[6] = {

28 
	~"mod–/»gi¡”_»que¡.h
"

29 
	~"mod–/block_»que¡.h
"

31 
şass
 
	gRegi¡”Reque¡
;

32 
şass
 
	gBlockReque¡
;

34 
	eSomeReque¡Ty³


36 
	mSomeReque¡Ty³_NÚe
,

37 
	mSomeReque¡Ty³_Regi¡”
,

38 
	mSomeReque¡Ty³_Block


41 
	sSomeReque¡


43 
	mpublic
:

44 
SomeReque¡
(
Regi¡”Reque¡
 *
»que¡
, 
timeout
 = 1000);

45 
SomeReque¡
(
BlockReque¡
 *
blockReque¡
, 
timeout
 = 10000);

46 
SomeReque¡
();

48 
Regi¡”Reque¡
* 
g‘Regi¡”Reque¡
();

49 
BlockReque¡
* 
g‘BlockReque¡
();

50 
SomeReque¡Ty³
 
ty³
(ècÚ¡ {  
	mm_»que¡Ty³
; }

51 
timeout
(ècÚ¡ {  
	mm_timeout
; }

53 
QSŒšg
 
g‘E¼ÜDesc
(
»que¡_”rÜ_t
 
”rÜCode
);

55 
	m´iv©e
:

58 
Regi¡”Reque¡
* 
»que¡
;

59 
BlockReque¡
* 
	mblockReque¡
;

62 
SomeReque¡Ty³
 
	mm_»que¡Ty³
;

63 
	mm_timeout
;

	@
1
.
1
/usr/include
29
471
block.cpp
block.h
block_request.cpp
block_request.h
block_request_machine.cpp
block_request_machine.h
blocks_map.cpp
blocks_map.h
card_scanner.cpp
card_scanner.h
communicator.cpp
communicator.h
cscope.files
faults_map.cpp
faults_map.h
global_state_machine.cpp
global_state_machine.h
parameter_set.cpp
parameter_set.h
register.cpp
register.h
register_poll.cpp
register_poll.h
register_request.cpp
register_request.h
registers_map.cpp
registers_map.h
request.cpp
request.h
